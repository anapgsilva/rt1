//
//  sceneLoader.m
//  rt1
//
//  Created by Stock Lab on 8/05/2014.
//  Copyright (c) 2014 a. All rights reserved.
//

#import "sceneLoader.h"
#import "beizerCurve.h"
#import "NAModelObject.h"
#import "colourPalette.h"
#import "vector_ops.h"

@interface sceneLoader () {
    dispatch_group_t _dispatch_group;
}

@end

@implementation sceneLoader

- (id)init {
    
    if (self = [super init]) {
        _dispatch_group = dispatch_group_create();
    }
    
    return self;
}

- (modelObject *) loadSceneMito {
    NSLog(@"Loading data");
    
    RGBColour specColour;
    specColour.red = 0.25;
    specColour.green = 0.25;
    specColour.blue = 0.25;
    
    RGBColour popcColour;
    popcColour.red = 0.85;
    popcColour.green = 0.85;
    popcColour.blue = 1.0;
    pdbData *popcData = [[pdbData alloc] init];
    [popcData setDiffuseColour:popcColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    popcData.CPK = NO;
    [popcData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc.pdb"];
    
    modelObject *popc = [[modelObject alloc] initWithPDBData:popcData];
    [popc rotateAroundX:0 Y:0 Z:-11.6 * radiansPerDegree];
    
    modelObject *popcRotate = [[modelObject alloc] init];
    [popcRotate addChildModel:popc];
    [popcRotate rotateAroundX:0 Y:0 Z:180 * radiansPerDegree];
    
    pdbData *popcHeadData = [[pdbData alloc] init];
    [popcHeadData setDiffuseColour:popcColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    popcHeadData.CPK = NO;
    [popcHeadData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc-headOnly.pdb"];
    
    modelObject *popcHead = [[modelObject alloc] initWithPDBData:popcHeadData];
    [popcHead rotateAroundX:0 Y:0 Z:-11.6 * radiansPerDegree];
    
    
    Vector start, end, i1, i2;
    Vector modelOrientation;
    
    modelOrientation.x = 0;
    modelOrientation.y = -1.0;
    modelOrientation.z = 0;
    modelOrientation.w = 0.0;
    
//    beizerCurve *testCurve = [[beizerCurve alloc] initWithSVGPath:@"m 0.0,1.0 C 1,1 1,1 1,0 1,-1 1,-1 0,-1 -1,-1 -1,-1 -1,0 -1,1 -1,1 0,1"];
//    Vector zero; zero.x = zero.y = zero.z = 0; zero.w = 1.0;
//    Vector tp; tp.x = -2; tp.y = 2; tp.z = 0; tp.w = 1.0;
//    float testT = [testCurve tValueForFirstIntersectionWithLineSegmentDefinedByPoint:zero andPoint:tp withResolution:1.0];
    
    
    beizerCurve *scaleCurve = [[beizerCurve alloc] initWithSVGPath:@"m 277.53942,270.12531 -48.26004,-0.17678"];
    beizerCurve *outerCurve = [[beizerCurve alloc] initWithSVGPath:@"m -189.54249,161.12985 c 6.84988,13.71682 22.34608,31.41491 44.62349,30.44347 4.39262,-0.19155 39.5637,26.9917 59.005952,40.87483 11.93815,8.52468 22.71896,1.30566 46.115101,7.83566 24.613489,6.86977 30.0135193,-9.21436 58.921394,-12.32133 15.54181,-1.67041 7.07224,-20.20711 27.74763,-24.83554 20.79183,-4.6545 15.18623,-10.59439 36.61014,-28.68991 4.80105,-4.05517 29.717503,-14.03914 37.636083,-28.88879 10.01013,-18.7719 23.31219,-5.59106 37.88072,-29.7995 10.97378,-18.235084 21.93362,-22.677543 43.02618,-40.919073 27.7031,-23.958525 38.99691,-24.884145 41.7635,-49.742118 2.47899,-22.2738099 4.26642,-43.58001 11.53783,-65.43894 7.23887,-21.76109 -5.87903,-43.10009 -7.43409,-65.123269 -1.51187,-21.41156 -9.04502,-42.30346 -16.72966,-61.98134 -8.12616,-20.80846 -29.28202,-15.93591 -40.34396,-29.94254 -15.95988,-20.20841 -38.45232,-8.43584 -57.04047,-18.56787 -21.80782,-11.88701 -11.9678,0.30012 -48.409983,-21.66462 -24.75023,-14.91766 -37.46355,-7.04218 -57.71287,-3.30667 -20.37437,3.75859 -36.7305747,11.75489 -55.361084,16.25715 -21.472191,5.18898 -35.400681,25.64907 -56.363361,28.24165 -16.879792,2.08762 -33.776822,2.3628 -44.825512,21.76879 -10.41515,18.29322 -28.07492,38.96209 -31.28473,46.03612 -8.4685,18.66355 -21.90236,19.97618 -40.87804,43.905339 -8.29309,10.45793 -14.15723,36.61183 -10.46198,50.29454 6.41731,23.76189 -8.10031,34.86394006 -4.9681,59.34489 2.0441,15.976433 -9.71976,34.351393 0.41195,51.260508 10.18836,17.00366 16.02626,30.736513 23.51604,49.388563 3.8529,9.59501 -1.94138,25.63923 3.01783,35.57 z"];
    //    float length = [outerCurve lengthWithResolution:1.0];
    [outerCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    //    length = [outerCurve lengthWithResolution:1.0];
    
    beizerCurve *innerCurve = [[beizerCurve alloc] initWithSVGPath:@"m 72.263001,-56.648481 c -2.4633,-2.05745 -3.452674,-1.46739 -3.728894,-5.33438 -0.27621,-3.86699 -0.27621,-2.76214 -1.93349,-6.35292 -1.65728,-3.59077 -1.10486,-4.69563 -3.31456,-6.35291 -2.20971,-1.65728 -5.24806,-8.28641 -6.35292,-9.39126 -1.10485,-1.10485 -3.31456,-4.41942 -5.52427,-6.90534 -2.20971,-2.48592 -4.97184,-6.0767 -6.62912,-8.01019 -1.65729,-1.933499 -2.76214,-3.314569 -7.18156,-7.457769 -4.41942,-4.1432 -9.66747,-8.83884 -11.32475,-12.42961 -1.65729,-3.59078 -0.82865,-4.41942 -4.14321,-6.90534 -3.31456,-2.48592 -8.01019,-8.56262 -10.49612,-10.77233 -2.4859196,-2.20971 -4.1432,-1.65728 -7.181545,-6.0767 -3.03835,-4.41942 -5.24805973,-4.69563 -7.7339798,-7.73398 -2.48592,-3.03835 -5.8004799,-5.52427 -7.1815502,-6.62913 -1.38107,-1.10485 -1.9335,-1.65728 -4.97185,-3.86699 -3.03835,-2.20971 -7.181549,-5.52427 -11.600969,-8.01019 -4.41941,-2.48592 -6.35291,-4.69563 -8.83883,-6.0767 -2.48592,-1.38107 -5.524271,-3.59078 -8.010201,-6.0767 -2.48592,-2.48592 -3.31456,-3.59078 -5.80048,-4.69563 -2.48592,-1.10486 -3.31456,-2.76214 -5.52427,-4.41942 -2.20971,-1.65728 -1.9335,-3.31456 -5.80049,-4.69563 -3.86699,-1.38107 -3.86699,-1.65728 -6.62912,-1.38107 -2.76214,0.27622 -1.9335,0 -6.35292,2.20971 -4.41941,2.20971 -4.97184,2.20971 -7.73398,3.31456 -2.76213,1.10486 -7.18155,2.48593 -10.2199,2.48593 -3.03835,0 -5.52427,0.27621 -8.838842,0.55242 -3.31455,0.27622 -10.21989,1.9335 -11.87717,2.76214 -1.65728,0.82864 -3.31456,4.41942 -3.59078,6.62913 -0.27621,2.2097 1.10486,4.97184 3.59078,6.35291 2.48592,1.38107 9.66748,7.18155 11.60096,9.11505 1.933502,1.93349 5.524272,8.2864 8.286412,11.04854 2.76213,2.76214 4.97184,5.52427 7.45777,7.73398 2.48592,2.20971 13.53446,11.60097 15.46796,14.36311 1.93349,2.76213 4.41941,5.80048 7.45776,9.11505 3.03835,3.31456 4.69563,6.07669 8.56262,8.83883 3.86699,2.76214 9.11505,7.73398 10.77233,9.11505 1.65729,1.38107 13.534471,12.153399 16.020391,14.915529 2.48592,2.76214 9.115049,9.66748 11.877189,12.98204 2.76213,3.31456 6.6291203,6.0767 9.3912602,10.2199 2.76213,4.14321 7.7339798,7.18156 10.4961198,11.32476 2.762125,4.14321 16.849015,21.26845 18.782515,25.13544 1.93349,3.86699 4.69563,6.0767 7.73398,10.49611 3.03835,4.41942 10.2199,11.0485501 11.87718,13.5344701 1.65729,2.48592 16.57282,20.4398099 19.05874,24.0305799 2.48592,3.59078 4.69563,5.80049 8.010204,9.391263 3.314561,3.59078 12.153391,15.46796 14.363106,18.50631 2.20971,3.03835 11.048548,12.1534 12.429608,14.639315 1.38107,2.48593 4.971855,5.52428 7.457775,9.11505 2.48592,3.59078 8.28641,10.49612 9.94369,13.53447 1.65728,3.03835 7.18155,8.83883 6.90534,11.877179 -0.27621,3.038354 -0.82864,7.733984 -3.59078,8.286414 -2.76213,0.55243 -5.52427,2.20971 -7.18155,-1.65728 -1.65728,-3.86699 -4.97185,-7.457774 -6.0767,-10.219903 -1.10485,-2.76214 -6.905345,-12.42962 -8.562625,-15.46796 -1.65728,-3.03835 -14.915533,-20.992235 -18.230103,-25.411645 -3.31456,-4.41942 -15.191745,-15.46797 -17.125245,-18.78253 -1.9335,-3.31456 -12.1534,-16.572813 -14.91553,-20.439803 -2.76214,-3.8669903 -13.25826,-16.5728199 -15.19175,-19.3349599 -1.9335,-2.76213 -16.84903,-19.6111601 -18.78253,-22.9257201 -1.9334896,-3.31457 -16.2965948,-17.12525 -17.9538748,-19.61117 -1.6572799,-2.48592 -4.4194202,-10.77233 -7.4577702,-12.98204 -3.03834,-2.20971 -13.810669,-15.74417 -16.572809,-18.78252 -2.76214,-3.03835 -17.401461,-15.19175 -19.887381,-17.40146 -2.48592,-2.20971 -16.02039,-14.363099 -18.2301,-16.572809 -2.2097,-2.20971 -21.82087,-22.64952 -24.85922,-24.85922 -3.03835,-2.20971 -11.048532,-9.11505 -14.363092,-10.49612 -3.31457,-1.38107 -8.0102,-4.97185 -11.87719,-4.69563 -3.86699,0.27621 -11.60097,1.10485 -14.36311,3.86699 -2.76213,2.76213 -8.01019,7.73398 -9.39126,9.94369 -1.38107,2.20971 -7.45776,12.70582 -8.28641,14.3631 -0.82864,1.65729 -4.97184,12.42962 -3.86699,14.91554 1.10486,2.48592 1.65729,1.93349 6.62913,5.24806 4.97185,3.31456 14.08689,8.286399 18.50631,10.496109 4.41942,2.20971 10.77233,5.52427 14.63932,7.73398 3.86699,2.20971 12.98204,8.56262 16.020382,9.94369 3.03835,1.38107 20.99223,11.32476 24.85922,14.63932 3.86699,3.31457 20.99223,15.46796 24.03058,19.33495 3.03835,3.86699 15.467971,12.70583 17.677671,16.02039 2.20971,3.31456 15.191749,13.81068 17.401459,16.57282 C -13.501318,-8.3974309 0.03314224,4.5846088 0.86179204,6.7943188 1.690432,9.0040287 12.186537,21.433639 13.291397,23.090919 c 1.10485,1.65728 9.94369,14.363113 11.87718,17.125243 1.9335,2.76214 5.24806,12.1534 7.73398,14.0869 2.48592,1.93349 11.60097,16.296595 13.53447,18.506305 1.93349,2.20971 5.80048,8.01019 6.62912,11.04854 0.82864,3.03835 1.9335,8.01019 1.38107,10.2199 -0.55243,2.209709 -1.93349,7.457773 -4.97184,8.562623 -3.03835,1.10486 -8.28641,3.86699 -8.56262,1.65729 -0.27622,-2.20971 0.27621,-4.41942 0.55242,-8.562624 0.27622,-4.143209 -1.10485,-12.153399 -2.76213,-13.810679 -1.65729,-1.65729 -6.90534,-11.87719 -8.0102,-14.0869 -1.10485,-2.20971 -7.45776,-11.324745 -8.01019,-12.982035 -0.55243,-1.65728 -4.14321,-8.56262 -5.24806,-10.2199 -1.10485,-1.65728 -6.0767,-11.60097 -8.8388296,-14.36311 C 5.833632,27.510339 -2.1765577,15.909369 -4.1100578,15.080729 -6.0435478,14.252089 -13.777538,2.9273291 -15.434818,1.5462591 -17.092098,0.16518906 -32.283847,-14.750341 -34.769767,-16.407621 c -2.48592,-1.65728 -15.467961,-14.63932 -17.953881,-16.57282 -2.48592,-1.93349 -13.25825,-13.25825 -16.57282,-14.91553 -3.31456,-1.65728 -16.02038,-11.87718 -18.50631,-12.98204 -2.48592,-1.10485 -17.125232,-10.49612 -19.887362,-11.60097 -2.76214,-1.10485 -12.98204,-5.52427 -15.74418,-7.45777 -2.76214,-1.93349 -16.02039,-8.83883 -19.61116,-10.2199 -3.59078,-1.38107 -8.83884,-3.31456 -12.42962,-5.24806 -3.59077,-1.93349 -7.45776,-3.31456 -10.2199,-3.31456 -2.76213,0 -5.80048,-0.82864 -9.11505,1.10485 -3.31456,1.9335 -8.56262,6.35292 -9.66747,7.73398 -1.10486,1.38107 -5.88058,3.6924 -8.0102,6.35292 -1.85281,2.3147 -4.41941,5.52427 -3.86699,8.01019 0.55243,2.48592 2.48593,6.35291 4.97185,6.90534 2.48592,0.55243 12.1534,3.59078 15.19175,4.1432 3.03834,0.55243 11.87718,4.69564 14.08689,6.0767 2.20971,1.38107 11.60097,3.86699 16.84903,6.0767 5.24806,2.20971 17.40145,8.0102 19.33495,9.39126 1.93349,1.38107 8.83883,1.65729 10.49611,3.59078 1.65729,1.9335 8.56263,5.80049 10.21991,6.62913 1.65728,0.82864 14.086882,8.2864 15.191732,9.94369 1.10486,1.65728 13.25826,11.60097 16.57282,13.8106801 3.31456,2.2097 13.25825,11.60097 16.02039,13.25825 2.76213,1.6572797 15.19175,12.9820399 17.125241,14.3630999 1.9335,1.38107 6.90534,6.0767 9.39126,8.83884 2.48592,2.762133 12.153399,15.467963 14.915539,17.677673 2.76213,2.20971 12.9820302,13.53446 13.5344602,14.91553 0.5524301,1.381065 8.2864098,9.943685 10.2198948,13.810675 1.9335004,3.86699 5.52428,9.66748 7.45777,12.70583 1.9335,3.03835 5.24806,11.600973 6.62913,14.363103 1.38107,2.76214 3.03835,6.62913 3.03835,8.56262 0,1.9335 2.48592,4.14321 -0.27622,6.0767 -2.76213,1.9335 -4.97184,4.69563 -6.62912,1.9335 -1.65728,-2.76214 -0.82864,-6.62913 -3.03835,-10.2199 -2.20971,-3.59078 -3.86699,-9.667484 -5.5242696,-12.153404 C 7.767117,92.696747 4.176352,87.172467 2.795282,84.410337 c -1.38107,-2.76214 -4.1431997,-8.28641 -6.0766998,-10.2199 -1.93349,-1.9335 -5.2480599,-8.0102 -8.0101902,-10.49612 -2.76214,-2.48592 -7.73398,-8.838835 -9.943689,-11.877185 -2.20971,-3.03834 -9.39126,-13.25825 -13.25825,-16.02038 -3.86699,-2.76214 -15.467971,-13.810683 -17.401461,-14.915543 -1.9335,-1.10485 -12.42961,-11.0485403 -13.53447,-12.1534003 -1.10485,-1.1048499 -14.63932,-14.3630996 -16.57281,-16.0203796 -1.9335,-1.65728 -8.28641,-5.5242701 -11.32476,-6.9053401 -3.03835,-1.38107 -10.772322,-6.35292 -13.534452,-8.28641 -2.76214,-1.9335 -11.60097,-7.45777 -16.29661,-9.94369 -4.69563,-2.48592 -16.84902,-6.0767 -20.16359,-8.01019 -3.31456,-1.9335 -18.23009,-7.73398 -20.16359,-8.56262 -1.93349,-0.82865 -17.40146,-6.35292 -20.71602,-6.35292 -3.31456,0 -9.39126,-2.48592 -11.87718,-1.10485 -2.48593,1.38107 -5.80049,2.76213 -6.0767,6.90534 -0.27622,4.1432 -2.20971,10.2199 -1.9335,12.1534 0.27622,1.93349 -1.38106,4.97184 0.82864,8.2864 2.20971,3.31457 2.48593,6.62913 5.80049,8.0102 3.31456,1.38107 7.45777,3.03835 10.49612,3.59077 3.03834,0.55243 6.90534,1.10486 10.77233,2.20971 3.86699,1.10486 12.15339,3.31457 14.63932,4.69563 2.48592,1.3810701 8.56262,3.3145701 11.60097,4.6956301 3.03835,1.38107 13.53446,7.18156 15.19174,8.83884 1.65728,1.6572797 6.35292,5.5242696 11.87719,7.4577699 5.52427,1.93349 13.25825,5.52427 15.19175,7.18155 1.93349,1.65728 8.286392,4.69563 10.772312,7.45777 2.48593,2.76213 12.42962,8.010193 16.29661,11.048543 3.86699,3.03835 12.70582,8.01019 14.08689,10.2199 1.38107,2.20971 4.97184,4.97185 7.73398,8.0102 2.76214,3.03835 6.62913,5.52427 10.49612,9.115045 3.86699,3.59077 12.982041,12.70582 14.086891,14.63932 1.10485,1.93349 4.41942,4.97184 6.0767,8.01019 1.65728,3.03835 4.41942,8.01019 7.45777,10.219899 3.038339,2.209714 6.352909,9.667484 9.115039,11.324764 2.7621403,1.65728 5.5242802,4.97184 9.1150502,6.0767 3.5907798,1.10485 5.8004898,3.31456 5.8004898,5.52427 0,2.20971 -0.55243,5.80049 -3.59077976,5.80049 -3.03835004,0 -7.45776994,0 -9.39125994,-2.76214 -1.9335003,-2.76214 -4.1432103,-6.62913 -7.1815503,-8.56262 -3.03835,-1.9335 -10.496119,-12.70583 -11.600979,-14.63932 -1.10485,-1.933504 -4.69563,-7.733983 -6.90533,-9.667483 -2.20971,-1.93349 -8.838841,-9.39126 -10.219911,-10.77233 -1.38107,-1.38107 -7.45776,-10.49611 -10.77233,-12.1534 -3.31456,-1.65728 -17.40145,-11.877175 -20.71602,-15.467955 -3.31456,-3.59077 -9.39126,-9.11504 -12.42961,-10.77233 -3.03835,-1.65728 -10.2199,-7.73398 -13.534452,-9.66747 -3.31457,-1.933503 -11.60097,-5.800493 -13.53447,-7.181553 -1.93349,-1.38107 -11.04854,-4.41942 -15.74417,-8.0102 -4.69564,-3.59078 -7.18156,-7.4577703 -11.32476,-8.0101902 -4.14321,-0.55243 -7.73398,-2.48593 -9.11505,-4.1432097 -1.38107,-1.65728 -13.81068,-7.73398 -17.12524,-8.83883 -3.31457,-1.10486 -8.56262,-3.86699 -13.53447,-3.86699 -4.97184,0 -8.56262,-0.8286401 -12.1534,0.27621 -3.59077,1.10486 -4.97184,1.38107 -6.35291,2.48592 -1.38107,1.10486 -4.01062,3.92223 -4.5299,6.85009996 -0.43679,2.46279004 -0.98332,4.69563974 -2.48593,8.06543964 -1.35453,3.0377403 -2.37543,3.5907703 -2.37543,6.9053403 0,3.31456 -0.27621,6.35291 3.86699,8.01019 4.1432,1.65728 5.24806,3.59078 12.1534,3.59078 6.90534,0 9.11505,-0.27622 14.63932,1.10485 5.52427,1.38107 10.49611,1.657283 13.81068,3.866993 3.31456,2.20971 4.97184,4.14321 9.11505,5.80049 4.1432,1.65728 11.32475,4.41942 13.81068,7.45776 2.48592,3.03835 4.97184,4.41942 8.83883,6.35292 3.86699,1.93349 7.18155,1.93349 9.66748,4.97184 2.48592,3.03835 5.24805,4.971845 9.11504,7.457765 3.86699,2.48592 12.70583,9.66747 14.36311,11.32476 1.65727,1.65728 8.838832,6.90534 11.048532,8.83883 2.20971,1.9335 9.39127,7.45777 12.42962,9.39126 3.03834,1.933499 7.73398,9.115053 9.66747,11.048553 1.9335,1.93349 6.62913,4.97184 7.73398,6.0767 1.10486,1.10485 8.83884,9.66747 11.04854,11.87718 2.20971,2.20971 6.90534,8.83883 8.28641,11.32476 1.381071,2.48592 4.971851,3.31456 6.352921,6.35291 1.38106,3.03835 10.49611,13.53446 11.32475,15.46796 0.82864,1.9335 3.03835,7.73398 3.03835,9.11505 0,1.38107 1.933499,5.52427 -0.27621,6.35291 -2.20971,0.82864 -6.0767,3.86699 -8.28641,0.55243 -2.20971,-3.31457 -7.18155,-8.83884 -7.18155,-11.87719 0,-3.03835 -4.14321,-11.87718 -6.076701,-14.63932 -1.9335,-2.76213 -4.41942,-11.32475 -8.28641,-13.53446 -3.86699,-2.20971 -9.94369,-7.18156 -12.42961,-10.77233 -2.48592,-3.59078 -10.2199,-11.32476 -11.87719,-12.42961 -1.65728,-1.10486 -11.60097,-10.772334 -12.98203,-11.877194 -1.38107,-1.10485 -9.66748,-6.352909 -11.32476,-8.010189 -1.657282,-1.65728 -8.838832,-8.56262 -11.324752,-10.49612 -2.48592,-1.93349 -9.11505,-6.0767 -12.1534,-7.73398 -3.03835,-1.65728 -7.18155,-5.80048 -9.66747,-7.45777 -2.48592,-1.657275 -6.35291,-2.485915 -9.11505,-3.866985 -2.76214,-1.38106 -12.98204,-9.66747 -14.36311,-10.2199 -1.38106,-0.55243 -4.41941,-5.24806 -8.83883,-6.62912 -4.41942,-1.38107 -9.11505,-3.59078 -12.1534,-3.59078 -3.03835,0 -13.53446,-2.76214 -16.84903,-2.76214 -3.31456,0 -6.90534,-0.82864 -9.39126,1.10486 -2.48592,1.93349 -6.62913,1.65728 -6.62913,5.80048 0,4.14321 -0.27621,7.18156 -0.27621,9.11505 0,1.9335 0,9.11505 0.55243,12.705825 0.55242,3.59077 0,11.60097 1.93349,13.81068 1.9335,2.2097 0.55243,3.59077 4.69563,5.24805 4.14321,1.65729 10.49612,5.24806 12.70583,5.24806 2.20971,0 8.83883,1.38107 12.1534,1.38107 3.31456,0 4.69563,-0.55243 8.56262,0.55243 3.86699,1.10485 9.66747,2.48592 12.98204,4.695629 3.31456,2.20971 7.73398,6.076704 11.32475,8.286414 3.59078,2.2097 9.39127,5.52427 12.98204,6.62912 3.59078,1.10486 12.1534,6.35291 15.46796,7.45777 3.31457,1.10485 7.18156,4.97184 10.21991,6.62912 3.03835,1.65729 12.982022,9.39127 15.744162,13.53447 2.76214,4.1432 6.90534,8.28641 9.39126,11.60097 2.48592,3.31456 11.32476,14.36311 14.63932,15.46796 3.31457,1.10486 9.11505,8.28641 11.87719,10.77233 2.76213,2.48592 8.01019,9.94369 11.32475,14.36311 3.314571,4.41942 5.248061,5.80048 7.181561,9.66747 1.93349,3.86699 5.52427,6.0767 6.35291,7.73398 0.82864,1.65729 3.32953,5.16212 4.41942,8.0102 0.87805,2.2945 2.76213,5.80048 1.65728,7.18155 -1.10486,1.38107 -3.59078,4.97185 -7.18155,3.31456 -3.59078,-1.65728 -5.52428,-6.90533 -7.73399,-10.77233 -2.209701,-3.86699 -6.629121,-9.39126 -8.286401,-11.87718 -1.65728,-2.48592 -5.24806,-11.04854 -8.28641,-12.70582 -3.03835,-1.65729 -4.1432,-4.69564 -6.62913,-6.90534 -2.48592,-2.20971 -11.60097,-9.39127 -13.25825,-12.1534 -1.65728,-2.76214 -6.35291,-7.73398 -9.66747,-11.60097 -3.31457,-3.86699 -9.39127,-10.77233 -13.25826,-14.36311 -3.866982,-3.59078 -12.982032,-11.32476 -15.191732,-13.25825 -2.20971,-1.9335 -3.59078,-5.52427 -9.39127,-7.73398 -5.80048,-2.20971 -12.15339,-5.24806 -16.2966,-8.56262 -4.1432,-3.31457 -10.49611,-5.24806 -17.12524,-8.56262 -6.62913,-3.31457 -13.53447,-6.35292 -18.78252,-7.45777 -5.24806,-1.10486 -10.77233,-1.9335 -13.53447,-1.10486 -2.76214,0.82865 -9.94369,2.76214 -7.18155,9.66748 2.76213,6.90534 5.52427,7.73398 8.56262,12.98204 3.03835,5.24806 2.20971,7.18155 3.03835,11.60097 0.82864,4.41942 2.20971,12.70582 3.31456,15.19175 1.10486,2.48592 2.48592,10.49611 3.86699,13.25825 1.38107,2.76213 5.80049,10.77233 9.39126,12.70582 3.59078,1.9335 3.31457,5.80049 8.83884,7.45777 5.52427,1.65728 16.57281,1.9335 20.16359,4.41942 3.59078,2.48592 14.36311,7.18155 18.50631,11.32476 4.1432,4.1432 12.98204,7.45776 16.02039,10.49611 3.03834,3.03835 12.982032,13.25825 16.020382,14.08689 3.03835,0.82865 14.91553,4.97185 17.40145,4.14321 2.48592,-0.82864 9.66748,-4.69563 12.1534,-3.31456 2.48592,1.38106 8.28641,4.41941 9.94369,5.24805 1.65728,0.82864 7.18155,3.31457 9.391261,3.31457 2.20971,0 7.18155,1.93349 10.2199,1.93349 3.03835,0 11.048549,-0.82864 11.877189,-1.38107 0.82864,-0.55242 9.3912603,-3.59077 11.0485402,-4.69563 1.65728,-1.10485 7.7339798,-6.0767 8.5626198,-6.90534 0.82864,-0.82864 5.524265,-5.52427 5.524265,-8.83883 0,-3.31456 -1.38106,-14.36311 0.55243,-17.95388 1.9335,-3.59078 6.90534,-9.11505 7.73398,-12.42962 0.82864,-3.31456 7.45777,-14.63932 8.28641,-17.67767 0.82864,-3.03835 3.86699,-12.15339 5.80049,-13.53446 1.93349,-1.38107 7.18155,-13.25825 9.94368,-13.25825 2.76214,0 10.49612,-1.38107 11.04855,0.82864 0.55243,2.20971 5.24806,8.83883 -0.55243,11.32475 -5.80048,2.48593 -7.18155,-1.93349 -9.11505,2.76214 -1.93349,4.69563 -6.35291,9.66748 -6.62912,12.42961 -0.27622,2.76214 -4.69563,12.1534 -6.0767,14.08689 -1.38107,1.9335 -2.76214,4.69564 -3.31457,8.28641 -0.55242,3.59078 1.38107,6.90534 -2.48592,9.66748 -3.86699,2.76213 -5.80048,7.45776 -5.80048,9.39126 0,1.93349 -0.27622,4.97184 -0.82864,7.73398 -0.55243,2.76214 -2.48593,2.76214 -0.55243,5.24806 1.93349,2.48592 6.0767,3.31456 7.45777,-0.82864 1.38106,-4.14321 0,-12.98204 3.03835,-15.19175 3.03834,-2.20971 5.80048,-5.24806 9.66747,-5.80049 3.86699,-0.55242 8.01019,-3.03834 10.49612,-5.80048 2.48592,-2.76214 5.80048,-4.1432 8.56262,-5.80049 2.76213,-1.65728 11.32476,-10.77233 12.98204,-11.87718 1.657284,-1.10485 12.982045,-10.2199 15.74418,-12.42961 2.76214,-2.20971 10.496118,-6.0767 12.153398,-6.62913 1.65728,-0.55243 7.733985,-1.93349 7.733985,-5.80048 0,-3.86699 0.82864,-8.56262 3.31456,-10.77233 2.48592,-2.20971 14.91554,-11.87719 19.61117,-13.25826 4.69563,-1.38106 16.84903,-5.24805 19.05873,-8.01019 2.20971,-2.76214 11.60098,-9.39126 12.42962,-17.40146 0.82864,-8.010193 -6.0767,-19.058733 -12.98204,-27.345143 C 138.13995,63.141887 127.36762,48.502572 121.84335,42.702092 116.31907,36.901602 97.812755,16.461799 96.155475,13.699659 94.498195,10.937519 80.411302,-5.3590809 75.991882,-9.5022809 71.572461,-13.645491 60.800127,-26.903741 58.037997,-30.770731 c -2.76214,-3.86699 -20.16359,-22.09709 -25.41165,-28.72621 -5.24806,-6.62913 -8.28641,-14.08689 -12.42961,-17.95388 -4.14321,-3.86699 -13.53447,-12.98204 -16.849025,-16.29661 -3.31456976,-3.31456 -10.7723297,-15.467959 -13.81068,-19.334949 -3.03835,-3.86699 -10.219899,-14.08689 -12.153399,-16.57281 -1.9335,-2.48592 -13.302446,-6.88324 -15.854664,-9.30287 -2.613543,-2.47777 1.469465,-6.43026 3.977484,-8.92723 2.043619,-2.03462 6.69732,-7.16872 8.894072,-4.552 2.2539,2.6848 5.745247,11.73355 6.850097,15.60054 1.10485,3.86699 6.90534,9.94369 9.3912603,13.81068 2.4859199,3.86699 7.45777,8.83884 10.21990974,11.60097 2.76212996,2.76214 8.01018536,11.32476 9.94367496,13.258259 1.9335,1.93349 11.04855,11.32475 13.25826,13.25825 2.20971,1.93349 7.18155,10.49612 9.94369,14.08689 2.76213,3.59078 5.80048,8.0102 8.2864,11.04855 2.48593,3.03834 6.62913,8.56262 8.83884,10.77233 2.20971,2.2097 3.86699,5.24805 9.11505,9.11504 5.24805,3.86699 13.810685,14.91554 16.572815,19.05874 2.76214,4.1432 9.115055,11.8771901 12.982045,15.4679601 3.866988,3.59078 12.705833,13.8106796 16.296603,17.1252399 3.59078,3.31457 13.81068,13.25826 16.02039,16.57282 2.20971,3.314563 14.36311,14.915533 17.12524,18.230103 2.76214,3.31456 6.90534,9.94369 10.49612,14.3631 3.59078,4.419415 8.83883,14.639315 11.60097,17.125245 2.76214,2.48592 5.80048,14.63932 12.70582,8.2864 6.90534,-6.35291 18.50631,-12.42961 21.54466,-14.63932 3.03835,-2.20971 10.49612,-7.73398 -6.90534,-11.600965 -17.40145,-3.86699 -22.09708,-11.04854 -27.89757,-16.2966 -5.80048,-5.24806 -23.47815,-19.887383 -21.54466,-25.687863 1.9335,-5.80049 5.52427,-5.24806 11.04855,-3.59078 5.52427,1.65728 9.11504,5.24806 12.15339,9.94369 3.03835,4.69563 12.42962,13.534473 17.95389,16.296603 5.52427,2.76214 12.15339,8.83884 17.12524,9.66748 4.97184,0.82864 12.42961,3.59077 16.02039,2.20971 3.59077,-1.38107 9.94369,-6.0767 9.39126,-8.83884 -0.55243,-2.76214 -0.27621,-7.73398 -6.0767,-9.94369 -5.80048,-2.20971 -12.70582,-4.1432 -16.02039,-6.905343 -3.31456,-2.76213 -11.04854,-8.01019 -14.08689,-12.1534 -3.03835,-4.1432 -12.70583,-14.63931994 -17.95388,-19.8873699 -5.24806,-5.2480601 -14.91554,-20.9922401 -19.88738,-24.8592301 -4.97185,-3.86699 -12.1534,-11.32475 -15.46796,-16.02039 -3.31457,-4.69563 -11.32476,-15.19174 -14.91554,-19.88737 -3.59077,-4.69563 -15.19174,-21.26845 -20.716025,-27.89758 -5.52427,-6.629119 -20.439803,-21.544659 -25.411654,-28.173779 -4.971844,-6.62913 -11.877184,-11.32476 -14.639324,-15.74418 -2.76213,-4.41941 -10.49611,-13.81068 -13.25825,-16.2966 -2.76213,-2.48592 -9.39126,-14.63932 -13.25825,-17.95388 -3.86699,-3.31456 -10.2199,-4.41942 -9.66748,-9.39126 0.55243,-4.97185 0.55243,-10.21991 6.0767,-8.28641 5.52427,1.93349 7.45777,5.80048 9.39126,9.66747 1.9335,3.86699 3.03835,5.80049 5.80049,9.11505 2.76214,3.31457 12.70583,16.57282 16.2966,20.16359 3.59078,3.59078 15.744185,20.99224 19.058745,22.64952 3.31456,1.65728 10.496125,8.56262 12.429613,11.32476 1.9335,2.76213 8.562621,6.0767 10.772335,10.49611 2.20971,4.41942 8.28641,8.562619 11.32476,14.639319 3.03835,6.0767 6.0767,11.04855 9.94369,16.02039 3.86699,4.97185 13.53446,17.12524 15.74417,20.16359 2.20971,3.03835 7.73398,11.87719 13.53447,16.57282 5.80048,4.69563 10.77233,14.63932 13.53446,17.67767 2.76214,3.03835 13.53447,14.3631001 14.63932,15.7441701 1.10486,1.38107 4.41942,6.07669996 8.56262,8.56262 4.14321,2.4859297 8.83884,8.8388399 10.77233,10.2199099 1.9335,1.38106 9.66748,5.52427 12.42962,6.07669 2.76213,0.55243 6.90534,3.03835 10.77233,3.03835 3.86699,0 2.48592,-0.55242 4.1432,-4.97184 1.65728,-4.41942 2.20971,-8.0101903 -2.48592,-14.0868899 -4.69563,-6.0767 -8.83884,-13.5344701 -10.77233,-16.0203901 -1.9335,-2.48592 -3.31457,-6.0767 -6.0767,-8.83884 -2.76214,-2.76213 -9.39126,-11.32475 -12.42961,-15.19174 -3.03835,-3.86699 -10.21991,-11.04855 -12.70583,-14.0869 -2.48592,-3.03835 -9.11505,-9.94369 -12.98204,-13.81068 -3.86699,-3.86699 -11.60097,-12.98203 -15.19174,-16.2966 -3.59078,-3.31456 -5.52428,-9.94369 -8.83884,-12.98204 -3.31456,-3.03835 -10.49611,-10.772329 -13.53446,-14.915529 -3.03835,-4.1432 -8.28641,-9.66748 -11.87719,-12.98204 -3.59078,-3.31456 -9.11505,-9.66747 -11.87718,-12.98204 -2.76214,-3.31456 -6.0767,-7.18155 -10.496125,-11.04854 -4.41942,-3.86699 -10.496118,-12.1534 -13.810678,-14.91553 -3.314565,-2.76214 -11.877186,-13.81068 -15.46797,-16.84903 -3.59078,-3.03835 -8.01019,-5.80049 -12.1534,-9.11505 -4.1432,-3.31456 -7.18155,-5.52427 -2.48592,-7.45777 4.69563,-1.93349 10.2199,-4.97184 12.1534,-1.38107 1.93349,3.59078 12.982045,19.61117 15.467965,20.99224 2.485925,1.38106 9.115053,7.45776 11.048543,11.87718 1.9335,4.41942 7.457771,10.49612 11.600975,12.42961 4.14321,1.9335 16.84903,18.78253 20.99224,21.26845 4.1432,2.48592 8.2864,8.01019 11.04854,11.32476 2.76214,3.31456 12.42961,13.25825 16.2966,17.677659 3.86699,4.41942 12.42961,17.40146 16.2966,20.1636 3.86699,2.76213 16.02039,20.16359 19.05874,22.64951 3.03835,2.48592 8.01019,5.24806 13.25825,9.94369 5.24806,4.69563 6.35291,11.04854 10.77233,16.02039 4.41942,4.97184 9.94369,12.70582 12.1534,15.74417 2.20971,3.03835 5.80049,11.3247601 6.35291,12.4296101 0.55243,1.10486 6.35292,6.35292 7.45777,1.93349996 1.10485,-4.41941996 -1.65728,-7.45776996 -0.55243,-10.77233006 1.10486,-3.31456 3.59078,-11.87718 3.59078,-14.91553 0,-3.03835 3.59078,-9.94369 -1.9335,-15.46797 -5.52427,-5.52427 -9.39126,-8.56262 -13.53446,-12.98203 -4.14321,-4.41942 -8.56262,-10.77233 -12.98204,-14.63932 -4.41942,-3.86699 -7.45777,-10.49612 -11.32476,-14.0869 -3.86699,-3.59077 -9.11505,-8.01019 -14.08689,-13.81068 -4.97185,-5.800479 -7.73398,-12.429609 -11.60097,-16.296599 -3.86699,-3.86699 -11.04854,-10.77233 -13.53447,-14.3631 -2.48592,-3.59078 -9.11505,-9.94369 -11.87718,-13.25826 -2.76214,-3.31456 -8.0102,-5.52427 -12.1534,-11.04854 -4.1432,-5.52427 -15.74417,-15.19175 -19.88738,-19.61117 -4.1432,-4.41941 -15.74417,-12.42961 -14.91553,-16.2966 0.82864,-3.86699 8.01019,-7.45776 12.1534,-4.41941 4.1432,3.03835 3.03835,8.56262 5.80048,11.60097 2.76214,3.03835 6.35291,8.01019 10.77233,11.04854 4.41942,3.03835 10.77233,11.60097 13.53447,13.25825 2.76213,1.65728 11.32475,11.60097 15.19175,14.36311 3.86699,2.76213 12.15339,17.12524 17.12524,20.16359 4.97184,3.03835 7.18155,9.11505 10.49611,11.04854 3.31457,1.9335 14.63932,11.877189 18.2301,16.020389 3.59078,4.14321 12.1534,16.84903 15.74418,19.61117 3.59077,2.76213 7.18155,10.2199 10.77233,12.70582 3.59077,2.48592 4.97184,4.14321 7.73398,5.52427 2.76213,1.38107 4.1432,1.10486 5.80048,-2.76213 1.65728,-3.86699 -1.69693,-13.06165 -4.69563,-24.3068 -1.04454,-3.91703 -0.66311,-21.785299 -3.60301,-34.727919 -3.56905,-15.71241 -8.52496,-23.02119 -17.31628,-35.48179 -3.06462,-4.34371 -13.84586,-25.88581 -36.84582,-37.17345 -6.98046,-3.42578 -2.7182,-7.13048 -10.53145,-10.00987 -9.36106,-3.44979 -14.3182,2.92226 -24.72655,0.31197 -11.92613,-2.99093 -23.32052,-9.26164 -34.36796,-13.09586 -5.73527,-1.99054 -4.3708,-6.33445 -23.669135,-6.94858 -12.037953,-0.38308 -9.832233,-12.21962 -23.686178,-16.36914 -10.41449,-3.11935 -32.8626,8.6329 -44.2937,9.35691 -4.74742,0.30069 -18.674705,5.04419 -25.1215148,6.61733 -3.0167,0.73613 -30.5456192,7.13519 -37.8385592,16.61324 -4.234721,5.50352 8.05688,13.50984 10.62475,18.22844 3.67509,6.75316 14.770799,14.34375 21.0193193,22.38339 4.3125099,5.54867 16.5277147,11.86367 21.5132247,17.71248 33.75328,39.59801 77.689588,84.147929 64.918725,92.224019 -2.36293,1.49428 -3.27883,-0.005 -5.256691,-1.65727 z"];
//    Vector crist; crist.x = -30; crist.y = -153; crist.z = 0; crist.w = 1.0;
    Vector crist; crist.x = -39; crist.y = -143; crist.z = 0; crist.w = 1.0;
    float tForATP = [innerCurve tValueClosestToPoint:crist withResolution:1.0];
    [innerCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    
    Vector gridDirection;
    gridDirection.x = 0;
    gridDirection.y = 0;
    gridDirection.z = 1.0;
    gridDirection.w = 0.0;
    beizerCurve *outerInsideCurve = [outerCurve curveBySubtractingNormalWithScale:28.0 segmentations:4 crossVector:gridDirection];
    beizerCurve *innerInsideCurve = [innerCurve curveBySubtractingNormalWithScale:28.0 segmentations:4 crossVector:gridDirection];
    
    modelObject *OMpopCCurve = [[modelObject alloc] init];
    modelObject *OMpopCCurveInner = [[modelObject alloc] init];
    [OMpopCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:outerCurve];
    [OMpopCCurveInner addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:outerInsideCurve];
    
    RGBColour protonColour;
    protonColour.red = 0.0;
    protonColour.green = 0.0;
    protonColour.blue = 0.0;
    RGBColour protonGlowColour;
    protonGlowColour.red = 1.0;
    protonGlowColour.green = 1.0;
    protonGlowColour.blue = 0.5;
    
    pdbData *protonData = [[pdbData alloc] init];
    [protonData setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    protonData.CPK = NO;
    [protonData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/proton.pdb"];
    
    modelObject *proton = [[modelObject alloc] initWithPDBData:protonData];
    [proton changeIntrinsicColourTo:protonGlowColour withMaxDistance:10.0 mode:REAL_POINT_SOURCE];
    [proton centerModelOnOrigin];
    
    modelObject *pool = [[modelObject alloc] init];
    [pool setupCurveBasedPoolOfModel:proton numModels:2000 boundingCurve:outerInsideCurve innerCurve:innerCurve nearZLimit:0 farZLimit:5 newModelEntryPoint:gridDirection];
    [pool enablePoolDiffusionWithMaxTransSpeed:4.0 maxRotSpeed:0 transChangeSize:0.8 rotChangeSize:0];
    
    //    modelObject *innerPool = [[modelObject alloc] init];
    //    [innerPool setupCurveBasedPoolOfModel:proton numModels:100 boundingCurve:innerInsideCurve innerCurve:nil nearZLimit:0 farZLimit:40 newModelEntryPoint:gridDirection];
    
    modelObject *IMpopCCurve = [[modelObject alloc] init];
    modelObject *IMpopCCurveInner = [[modelObject alloc] init];
    [IMpopCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerCurve];
    [IMpopCCurveInner addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerInsideCurve];
    
    modelObject *mm = [[modelObject alloc] init];
    //    [mm addChildModel:OMpopCCurve];
    //    [mm addChildModel:OMpopCCurveInner];
    //    [mm addChildModel:IMpopCCurve];
    //    [mm addChildModel:IMpopCCurveInner];
    [mm addGridOfModel:OMpopCCurve xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [mm addGridOfModel:OMpopCCurveInner xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [mm addGridOfModel:IMpopCCurve xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [mm addGridOfModel:IMpopCCurveInner xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [mm addChildModel:pool];
    //    [mm addChildModel:innerPool];
    
    //    Vector p = [mm positionAndRadiusOfEncompassingSphere];
    
    
    //    [mm translateToX:-p.x Y:-p.y Z:-p.z];
    
    modelObject *newWorld = [[modelObject alloc] init];
    [newWorld addChildModel:mm];
    
    NSLog(@"Finished - number of atoms: %u", [newWorld numModelData]);
    
    return newWorld;
    
}

- (modelObject *)loadScene {
    
    pdbData *fliFMemPDB = [[pdbData alloc] init];
    modelObject *fliFMem = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fliFMemPDB setDiffuseColour:fliFColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fliFMemPDB.CPK = NO;
        [fliFMemPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/fliF.pdb"];
        
        [fliFMem setModelWithPDBData:fliFMemPDB];
    });
    
    pdbData *fliFCPDB = [[pdbData alloc] init];
    modelObject *fliFC = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fliFCPDB setDiffuseColour:fliFColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fliFCPDB.CPK = NO;
        [fliFCPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/fliFC.pdb"];
        
        [fliFC setModelWithPDBData:fliFCPDB];
    });
    
    pdbData *fliGPDB = [[pdbData alloc] init];
    modelObject *fliG = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fliGPDB setDiffuseColour:fliGColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fliGPDB.CPK = NO;
        [fliGPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/fliGM.pdb"];
        
        [fliG setModelWithPDBData:fliGPDB];
    });

    pdbData *fliMPDB = [[pdbData alloc] init];
    modelObject *fliM = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fliMPDB setDiffuseColour:fliMColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fliMPDB.CPK = NO;
        [fliMPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/fliM.pdb"];
        
        [fliM setModelWithPDBData:fliMPDB];
    });

    pdbData *fliNPDB = [[pdbData alloc] init];
    modelObject *fliN = [[modelObject alloc] init];
    modelObject *fliN_B = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fliNPDB setDiffuseColour:fliNColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fliNPDB.CPK = NO;
        [fliNPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/fliN.pdb"];
        
        [fliN setModelWithPDBData:fliNPDB];
        [fliN_B setModelWithPDBData:fliNPDB];
    });

    pdbData *motAPDB = [[pdbData alloc] init];
    modelObject *motA = [[modelObject alloc] init];
    modelObject *motA2 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [motAPDB setDiffuseColour:motAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        motAPDB.CPK = NO;
        [motAPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/mot.pdb"];
        
        [motA setModelWithPDBData:motAPDB];
        [motA2 setModelWithPDBData:motAPDB];
    });

    pdbData *motBCPDB = [[pdbData alloc] init];
    modelObject *motBC = [[modelObject alloc] init];
    modelObject *motBC2 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [motBCPDB setDiffuseColour:motBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        motBCPDB.CPK = NO;
        [motBCPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/motBC.pdb"];
        
        [motBC setModelWithPDBData:motBCPDB];
        [motBC2 setModelWithPDBData:motBCPDB];
    });

    pdbData *motBNPDB = [[pdbData alloc] init];
    modelObject *motBN = [[modelObject alloc] init];
    modelObject *motBN2 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [motBNPDB setDiffuseColour:motBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        motBNPDB.CPK = NO;
        [motBNPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/motBN.pdb"];
        
        [motBN setModelWithPDBData:motBNPDB];
        [motBN2 setModelWithPDBData:motBNPDB];
    });

    pdbData *shaftPDB = [[pdbData alloc] init];
    modelObject *shaft = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [shaftPDB setDiffuseColour:shaftColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        shaftPDB.CPK = NO;
        [shaftPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/shaftTrunc.pdb"];
        
        [shaft setModelWithPDBData:shaftPDB];
    });

    pdbData *hookPDB = [[pdbData alloc] init];
    modelObject *hook = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [hookPDB setDiffuseColour:shaftColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        hookPDB.CPK = NO;
        [hookPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/flagellar/3A69.pdb"];
        
        [hook setModelWithPDBData:hookPDB];
    });

    //ATPase
    
/*    //Subunit M
    pdbData *subMPDB = [[pdbData alloc] init];
    modelObject *subM = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [subMPDB setDiffuseColour:subMColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subMPDB.CPK = NO;
        [subMPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubM.pdb"];
        
        [subM setModelWithPDBData:subMPDB];
        [subM enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });
    
    //Subunit A
    pdbData *subAaPDB = [[pdbData alloc] init];
    modelObject *subAa = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAaPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAaPDB.CPK = NO;
        [subAaPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAa.pdb"];
        subAaPDB.numStates = 180;
        [subAa setModelWithPDBData:subAaPDB];
        //        [subAa animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subAbPDB = [[pdbData alloc] init];
    modelObject *subAb = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAbPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAbPDB.CPK = NO;
        [subAbPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAb.pdb"];
        subAbPDB.numStates = 180;
        [subAb setModelWithPDBData:subAbPDB];
        //        [subAb animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subAcPDB = [[pdbData alloc] init];
    modelObject *subAc = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAcPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAcPDB.CPK = NO;
        [subAcPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAc.pdb"];
        subAcPDB.numStates = 180;
        [subAc setModelWithPDBData:subAcPDB];
        //        [subAc animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit B
    pdbData *subBaPDB = [[pdbData alloc] init];
    modelObject *subBa = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBaPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBaPDB.CPK = NO;
        [subBaPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubBa.pdb"];
        subBaPDB.numStates = 180;
        [subBa setModelWithPDBData:subBaPDB];
        //        [subBa animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subBbPDB = [[pdbData alloc] init];
    modelObject *subBb = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBbPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBbPDB.CPK = NO;
        [subBbPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subBb.pdb"];
        subBbPDB.numStates = 180;
        [subBb setModelWithPDBData:subBbPDB];
        //        [subBb animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subBcPDB = [[pdbData alloc] init];
    modelObject *subBc = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBcPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBcPDB.CPK = NO;
        [subBcPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subBc.pdb"];
        subBcPDB.numStates = 180;
        [subBc setModelWithPDBData:subBcPDB];
        //        [subBc animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit C
    pdbData *subCPDB = [[pdbData alloc] init];
    modelObject *subC = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subCPDB setDiffuseColour:subCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subCPDB.CPK = NO;
        [subCPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubC.pdb"];
        subCPDB.numStates = 180;
        [subC setModelWithPDBData:subCPDB];
        //        [subC animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit G
    pdbData *subGPDB = [[pdbData alloc] init];
    modelObject *subG = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subGPDB setDiffuseColour:subGColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subGPDB.CPK = NO;
        [subGPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubG.pdb"];
        subGPDB.numStates = 180;
        [subG setModelWithPDBData:subGPDB];
        //        [subG animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit D
    pdbData *subDPDB = [[pdbData alloc] init];
    modelObject *subD = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subDPDB setDiffuseColour:subDColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subDPDB.CPK = NO;
        [subDPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubD.pdb"];
        subDPDB.numStates = 180;
        [subD setModelWithPDBData:subDPDB];
        //        [subD animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit E
    pdbData *subEPDB = [[pdbData alloc] init];
    modelObject *subE = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subEPDB setDiffuseColour:subEColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subEPDB.CPK = NO;
        [subEPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subE.pdb"];
        subEPDB.numStates = 180;
        [subE setModelWithPDBData:subEPDB];
        //        [subE animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *stalkPDB = [[pdbData alloc] init];
    modelObject *stalk = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [stalkPDB setDiffuseColour:stalkColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        stalkPDB.CPK = NO;
        [stalkPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/Stalk.pdb"];
        stalkPDB.numStates = 180;
        [stalk setModelWithPDBData:stalkPDB];
        //        [stalk animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *protonPDB = [[pdbData alloc] init];
    [protonPDB setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    protonPDB.CPK = NO;
    [protonPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/Hydrogens.pdb"];
    protonPDB.numStates = 180;
    modelObject *protons = [[modelObject alloc] initWithPDBData:protonPDB];
    [protons changeIntrinsicColourTo:protonGlowColour withMaxDistance:10.0 mode:REAL_BROAD_SOURCE];
    
    //GPCR
    pdbData *bARPDB = [[pdbData alloc] init];
    modelObject *bAR = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [bARPDB setDiffuseColour:bARColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        bARPDB.CPK = NO;
        [bARPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/2Y03A.pdb"];
        
        [bAR setModelWithPDBData:bARPDB];
    });
    */
    dispatch_group_wait(_dispatch_group, DISPATCH_TIME_FOREVER);
    
    
    pdbData *popc = [[pdbData alloc] init];
    [popc setDiffuseColour:popcColour specularColour:specColour shininess:5 mirrorFrac:0];
    popc.CPK = NO;
    [popc initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc-headonly.pdb"];
    
    
    pdbData *pgcn = [[pdbData alloc] init];
    [pgcn setDiffuseColour:pgcnColour specularColour:specColour shininess:5 mirrorFrac:0];
    pgcn.CPK = NO;
    [pgcn initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/peptidoglycan.pdb"];
    
    modelObject *popcMonomer = [[modelObject alloc] initWithPDBData:popc];
    [popcMonomer centerModelOnOrigin];
    [popcMonomer rotateAroundX:0 Y:0 Z:-10 * radiansPerDegree];
    
    Vector exclusionPoint;
    exclusionPoint.x = 190; exclusionPoint.y = 0; exclusionPoint.z = 0;
    
    modelObject *membraneTop = [[modelObject alloc] init];
    [membraneTop addGridOfModel:popcMonomer xNumMembers:220 xSpacing:6 zNumMembers:200 zSpacing:6 excludedPoint:exclusionPoint withRadius:40];
//    [membraneTop centerModelOnOrigin];
    [membraneTop translateToX:0 Y:-16 Z:0];
    
    modelObject *membraneLower = [[modelObject alloc] init];
    [membraneLower addGridOfModel:popcMonomer xNumMembers:220 xSpacing:6 zNumMembers:200 zSpacing:6 excludedPoint:exclusionPoint withRadius:40];
//    [membraneLower centerModelOnOrigin];
    [membraneLower rotateAroundX:180 * radiansPerDegree Y:0 Z:0];
    [membraneLower translateToX:0 Y:16 Z:0];
    
    modelObject *innerMembrane = [[modelObject alloc] init];
    [innerMembrane changeDiffuseColourTo:innerMemColour];
    [innerMembrane addChildModel:membraneTop];
    [innerMembrane addChildModel:membraneLower];
//    [innerMembrane translateToX:0 Y:0 Z:100];
    [innerMembrane enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];
    
    modelObject *outerMembrane = [[modelObject alloc] init];
    [outerMembrane addChildModel:membraneTop];
    [outerMembrane addChildModel:membraneLower];
    [outerMembrane translateToX:0 Y:-250 Z:100];
    
    modelObject *peptidoglycanMonomer = [[modelObject alloc] initWithPDBData:pgcn];
    [peptidoglycanMonomer centerModelOnOrigin];
    [peptidoglycanMonomer rotateAroundX:150 * radiansPerDegree Y:0 Z:0 * radiansPerDegree];
    [peptidoglycanMonomer translateToX:0 Y:-15 Z:0];
    
    modelObject *peptidoglycanMonomer2 = [[modelObject alloc] initWithPDBData:pgcn];
    [peptidoglycanMonomer2 centerModelOnOrigin];
    [peptidoglycanMonomer2 rotateAroundX:150 * radiansPerDegree Y:0 Z:0 * radiansPerDegree];
    [peptidoglycanMonomer2 translateToX:0 Y:0 Z:0];
    
    modelObject *peptidoglycanMonomer3 = [[modelObject alloc] initWithPDBData:pgcn];
    [peptidoglycanMonomer3 centerModelOnOrigin];
    [peptidoglycanMonomer3 rotateAroundX:150 * radiansPerDegree Y:0 Z:0 * radiansPerDegree];
    [peptidoglycanMonomer3 translateToX:0 Y:15 Z:0];
    
    modelObject *peptidoglycan = [[modelObject alloc] init];
    [peptidoglycan addGridOfModel:peptidoglycanMonomer xNumMembers:130 xSpacing:10 zNumMembers:2 zSpacing:10];
    [peptidoglycan addGridOfModel:peptidoglycanMonomer2 xNumMembers:130 xSpacing:10 zNumMembers:2 zSpacing:10];
    [peptidoglycan addGridOfModel:peptidoglycanMonomer3 xNumMembers:130 xSpacing:10 zNumMembers:2 zSpacing:10];
    [peptidoglycan centerModelOnOrigin];
    [peptidoglycan translateToX:0 Y:-125 Z:100];
    [peptidoglycan enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];
    
    [fliFC centerModelOnOrigin];
    [fliFC translateToX:145 Y:70 Z:15];
    modelObject *fliFSingle = [[modelObject alloc] init];
    [fliFSingle addChildModel:fliFMem];
    [fliFSingle addChildModel:fliFC];
    //    [newObject centerPDBModelOnOrigin];
     //    [newObject rotateAroundX:0 Y:0 Z:90 * radiansPerDegree];
     //    [newObject translateToX:-15 Y:0 Z:0];
     //    RGBColour diffRed, specRed;
     //    diffRed.red = 0.5; diffRed.green = 0.011; diffRed.blue = 0;
     //    specRed.red = 0.8; specRed.green = 0.4; specRed.blue = 0.1;
     //    [newObject changeDiffuseColourTo:diffRed];
     //    [newObject changeSpecularColourTo:specRed];
    
    [fliG rotateAroundX:0 Y:0 Z:90 * radiansPerDegree];
    [fliG rotateAroundX:0 Y:80 * radiansPerDegree Z:0];
    
    [fliM centerModelOnOrigin];
    [fliM rotateAroundX:0 Y:0 Z:100 * radiansPerDegree];
    [fliM rotateAroundX:200 * radiansPerDegree Y:0 Z:0];
    [fliM translateToX:0 Y:145 Z:15];
    
    [fliN centerModelOnOrigin];
    [fliN rotateAroundX:0 * radiansPerDegree Y:0 Z:30 * radiansPerDegree];
    [fliN rotateAroundX:0 Y:150 * radiansPerDegree Z:0];
    [fliN rotateAroundX:30 * radiansPerDegree Y:0 Z:0];
    [fliN translateToX:0 Y:22 Z:0];
    
    [fliN_B centerModelOnOrigin];
    [fliN_B rotateAroundX:0 * radiansPerDegree Y:0 Z:30 * radiansPerDegree];
    [fliN_B rotateAroundX:0 Y:150 * radiansPerDegree Z:0];
    [fliN_B rotateAroundX:210 * radiansPerDegree Y:0 Z:0];
    [fliN_B translateToX:0 Y:-22 Z:0];
    
    modelObject *fliNTetramer = [[modelObject alloc] init];
    [fliNTetramer addChildModel:fliN];
    [fliNTetramer addChildModel:fliN_B];
    [fliNTetramer rotateAroundX:0 Y:180 * radiansPerDegree Z:0];
    [fliNTetramer translateToX:0 Y:0 Z:20];
    
    
    modelObject *shaftModel = [[modelObject alloc] init];
    [shaftModel addCircleOfModel:shaft numMembers:18 radius:0];
    [shaftModel translateToX:0 Y:-5 Z:0];
    
    modelObject *motASingle = [[modelObject alloc] init];
    [motASingle addCircleOfModel:motA numMembers:18 radius:0];
    [motASingle centerModelOnOrigin];
    
    
    modelObject *motBNSingle = [[modelObject alloc] init];
    [motBNSingle addCircleOfModel:motBN numMembers:18 radius:0];
    [motBNSingle centerModelOnOrigin];
    [motBNSingle translateToX:0 Y:-10 Z:0];
    
    [motBC centerModelOnOrigin];
    
    modelObject *motBCDimer = [[modelObject alloc] init];
    [motBCDimer addCircleOfModel:motBC numMembers:2 radius:15];
    [motBCDimer translateToX:0 Y:-40 Z:0];
    
    modelObject *stator = [[modelObject alloc] init];
    [stator addChildModel:motBNSingle];
    [stator addChildModel:motASingle];
    [stator addChildModel:motBCDimer];
    [stator translateToX:1000 Y:5 Z:0];
    
    modelObject *stator2 = [[modelObject alloc] init];
    [stator2 addChildModel:motBNSingle];
    [stator2 addChildModel:motASingle];
    [stator2 addChildModel:motBCDimer];
    [stator2 translateToX:-1000 Y:5 Z:0];
    
    //    modelObject *statorRing = [[modelObject alloc] init];
    //    [statorRing addCircleOfModel:stator withAngleOffset:30 * radiansPerDegree numMembers:3 radius:0];
    //    [statorRing translateToX:0 Y:5 Z:0];
    
    modelObject *fliFOligo = [[modelObject alloc] init];
    [fliFOligo addCircleOfModel:fliFSingle numMembers:26 radius:0];
    
    modelObject *fliGOligo = [[modelObject alloc] init];
    [fliGOligo addCircleOfModel:fliG numMembers:34 radius:0];
    [fliGOligo translateToX:0 Y:70 Z:0];
    
    modelObject *fliMOligo = [[modelObject alloc] init];
    [fliMOligo addCircleOfModel:fliM numMembers:34 radius:220];
    
    modelObject *fliNOligo = [[modelObject alloc] init];
    [fliNOligo addCircleOfModel:fliNTetramer numMembers:34 radius:220];
    [fliNOligo translateToX:0 Y:210 Z:0];
    
    [hook centerModelOnCenterOfMass];
    [hook rotateAroundX:-90 * radiansPerDegree Y:0 Z:0];
    modelObject *hookOligo = [[modelObject alloc] init];
    [hookOligo addCircleOfModel:hook numMembers:11 radius:-57];
    
    modelObject *hookFilament = [[modelObject alloc] init];
    for (int i = 0; i < 10; i++) {
        modelObject *rotatedHook = [[modelObject alloc] init];
        [rotatedHook addChildModel:hookOligo];
        [rotatedHook rotateAroundX:0 Y:i * 18 * radiansPerDegree Z:0];
        [rotatedHook translateToX:0 Y:i * -20 Z:0];
        [hookFilament addChildModel:rotatedHook];
    }
    
    [hookFilament translateToX:0 Y:-250 Z:0];
    
    modelObject *rotor = [[modelObject alloc] init];
    [rotor addChildModel:fliFOligo];
//    [rotor setName:@"fliFOligo" forChild:fliFOligo];
    [rotor addChildModel:fliGOligo];
//    [rotor setName:@"fliGOligo" forChild:fliGOligo];
    [rotor addChildModel:fliMOligo];
//    [rotor setName:@"fliMOligo" forChild:fliMOligo];
    [rotor addChildModel:fliNOligo];
//    [rotor setName:@"fliNOligo" forChild:fliNOligo];
    [rotor addChildModel:shaftModel];
//    [rotor setName:@"shaftOligo" forChild:shaftModel];
    [rotor addChildModel:hookFilament];
//    [rotor setName:@"hookFilament" forChild:hookFilament];
    [rotor enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];

    Vector axis; axis.x = 0; axis.y = 1.0; axis.z = 0.0; axis.w = 0;
    [rotor animateRotationAroundAxis:axis byAnglePerEvent:10 * radiansPerDegree durationPerEvent:60];
    
//    [rotor animateRotationAroundX:0 Y:820 * radiansPerDegree Z:0 duration:820];
//    [rotor animateRotationAroundAxis:axis byAnglePerFrame:0.5 * radiansPerDegree];
    
    modelObject *bfm = [[modelObject alloc] init];
    [bfm addChildModel:rotor];
//    [bfm translateToX:400 Y:0 Z:0];
/*
    [bAR translateToX:-300 Y:0 Z:0];
    [bAR enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];
*/
    /*modelObject *ATPaseRotor = [[modelObject alloc] init];
    [ATPaseRotor addChildModel:subC];
    [ATPaseRotor addChildModel:subD];
    [ATPaseRotor addChildModel:subE];
    [ATPaseRotor addChildModel:subG];
    [ATPaseRotor addChildModel:protons];
    [ATPaseRotor animateModelStateWithInitialOffset:0 initialSpeed:0.0];
    [ATPaseRotor enableModelStateWobbleWithMax:5 changeSize:0.5 minChangeSize:2.0];
    
    modelObject *atpase = [[modelObject alloc] init];
    [atpase addChildModel:subAa];
    [atpase addChildModel:subAb];
    [atpase addChildModel:subAc];
    [atpase addChildModel:subBa];
    [atpase addChildModel:subBb];
    [atpase addChildModel:subBc];
    [atpase addChildModel:subM];
    [atpase addChildModel:ATPaseRotor];
    [atpase addChildModel:stalk];
    [atpase rotateAroundX:90 * radiansPerDegree Y:30 * radiansPerDegree Z:0];
    [atpase enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];
    [atpase animateModelStateWithInitialOffset:0 initialSpeed:0];
    //    [atpase animateRotationAroundX:0 Y:180 * radiansPerDegree Z:0 duration:120];
//    [atpase setClipForModelTo:YES];
    
    modelObject *atpaseRotate = [[modelObject alloc] init];
    [atpaseRotate addChildModel:atpase];
    [atpaseRotate rotateAroundX:0 Y:180 * radiansPerDegree Z:0];
    [atpaseRotate translateToX:-100 Y:50 Z:0];*/
    
    pdbData *protonData = [[pdbData alloc] init];
    [protonData setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    protonData.CPK = NO;
    [protonData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/proton.pdb"];
    
    modelObject *protonNoGlow = [[modelObject alloc] initWithPDBData:protonData];
    [protonNoGlow changeDiffuseColourTo:atpColour];

    modelObject *proton = [[modelObject alloc] initWithPDBData:protonData];
    [proton changeIntrinsicColourTo:protonGlowColour withMaxDistance:40.0 mode:CRUDE_ONE_FACE];
    [proton centerModelOnOrigin];
//    [proton setClipForModelTo:YES];
    
    Vector c1, c2, e1;
    c1.x = -700; c1.y = -30; c1.z = -200; c1.w = 0;
    c2.x = 700; c2.y = -450; c2.z = 200; c2.w = 0;
    //    c1.x = -400; c1.y = 150; c1.z = -100; c1.w = 0;
    //    c2.x = 400; c2.y = 250; c2.z = 100; c2.w = 0;
    e1.x = 0; e1.y = -300; e1.z = 100; e1.w = 0;

    [bfm applyTransformation];

    modelObject *protonPool = [[modelObject alloc] init];
    [protonPool addPoolExclusionZoneBasedOn:shaftModel];
//    [protonPool setupCurveBasedPoolOfModel:proton numModels:100 boundingCurve:innerBoundaryCurve innerCurve:nil nearZLimit:0 farZLimit:200 newModelEntryPoint:e1];
    [protonPool setupPoolOfModel:proton numModels:150 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [protonPool enablePoolDiffusionWithMaxTransSpeed:5.0 maxRotSpeed:0.0 transChangeSize:1.5 rotChangeSize:0.00];
//    [protonPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    [protonPool changePoolReplacementTo:YES];
    
    modelObject *matrixPool = [[modelObject alloc] init];
    [matrixPool addPoolExclusionZoneBasedOn:bfm];
    c1.x = -1500; c1.y = 30; c1.z = 0; c1.w = 0;
    c2.x = 1500; c2.y = 600; c2.z = 1000; c2.w = 0;
    e1.x = 200; e1.y = 320; e1.z = 0; e1.w = 0;
//    [matrixPool setupCurveBasedPoolOfModel:proton numModels:2 boundingCurve:outerStartCurve innerCurve:nil nearZLimit:0 farZLimit:200 newModelEntryPoint:e1];
    [matrixPool setupPoolOfModel:proton numModels:10 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [matrixPool enablePoolDiffusionWithMaxTransSpeed:5.0 maxRotSpeed:0.1 transChangeSize:1.5 rotChangeSize:0.01];
//    [matrixPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];


    
    modelObject *world = [[modelObject alloc] init];
    [world addChildModel:bfm];
//    [world addChildModel:bAR];
//    [world addChildModel:atpaseRotate];
    [world setName:@"bfm" forChild:bfm];
    [world setName:@"fliM" forChild:fliM];
    [world setName:@"rotor" forChild:rotor];
    [world setName:@"fliF" forChild:fliFSingle];
    [world setName:@"fliG" forChild:fliG];
    [world setName:@"fliN" forChild:fliNTetramer];
    [world setName:@"rotor" forChild:rotor];
    [world addChildModel:innerMembrane];
//    [world addChildModel:peptidoglycan];
    [world addChildModel:stator];
    [world setName:@"stator1" forChild:stator];
    [world addChildModel:stator2];
    [world setName:@"stator2" forChild:stator2];
    [world addChildModel:protonPool];
    [world setName:@"protonPool" forChild:protonPool];
    [world addChildModel:matrixPool];
    [world setName:@"matrixPool" forChild:matrixPool];
    [world setName:@"motB" forChild:motBNSingle];
    [world setName:@"motBN" forChild:motBNSingle];
    [world setName:@"motBCDimer" forChild:motBCDimer];
    [world setName:@"motBCMonomer" forChild:motBC];
    
    [world enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    
    return world;
}

- (modelObject *)loadSceneDNA {
    Vector start, end, i1, i2;
    start.x = -65; start.y = 0; start.z = 0; start.w = 0;
    end.x = 65; end.y = 0; end.z = 0; end.w = 0;
    i1.x = -25; i1.y = 40; i1.z = 0; i1.w = 0;
    i2.x = 25; i2.y = -40; i2.z = 0; i2.w = 0;
    beizerCurve *curve = [[beizerCurve alloc] init];
    [curve addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    end.x = -65; end.y = -50;
    i2.x = -55; i2.y = -50; i2.z = 20;
    [curve addCurveWithSymmetricalJoinWithI2:i2 end:end];

    NAModelObject *dna = [[NAModelObject alloc] initWithCurve:curve initialOffset:0 initialTwist:0 helicalTwist:36.5*radiansPerDegree helicalRise:3.3 nucleicAcidType:kNucleicAcidTypeDNA sequence:nil];
    
    modelObject *world = [[modelObject alloc] init];
    [world addChildModel:dna];
    
    return world;
}

- (modelObject *)loadSceneTF55 {
    pdbData *aChainPDB = [[pdbData alloc] init];
    modelObject *aChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [aChainPDB setDiffuseColour:com1Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        aChainPDB.CPK = NO;
//        aChainPDB.hydrophobic = YES;
        [aChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/ABG_1.pdb"];
        
        [aChain setModelWithPDBData:aChainPDB];
    });

    pdbData *bChainPDB = [[pdbData alloc] init];
    modelObject *bChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [bChainPDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        bChainPDB.CPK = NO;
//        bChainPDB.hydrophobic = YES;
        [bChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/ABG_2.pdb"];
        
        [bChain setModelWithPDBData:bChainPDB];
    });

    pdbData *cChainPDB = [[pdbData alloc] init];
    modelObject *cChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [cChainPDB setDiffuseColour:com4Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        cChainPDB.CPK = NO;
//        cChainPDB.hydrophobic = YES;
        [cChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/ABG_gamma.pdb"];
        
        [cChain setModelWithPDBData:cChainPDB];
    });

    /*pdbData *dChainPDB = [[pdbData alloc] init];
    modelObject *dChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [dChainPDB setDiffuseColour:cytoCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        dChainPDB.CPK = NO;
        dChainPDB.hydrophobic = YES;
        [dChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_e.pdb"];
        
        [dChain setModelWithPDBData:dChainPDB];
    });

    pdbData *eChainPDB = [[pdbData alloc] init];
    modelObject *eChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [eChainPDB setDiffuseColour:subMColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        eChainPDB.CPK = NO;
        eChainPDB.hydrophobic = YES;
        [eChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_g.pdb"];
        
        [eChain setModelWithPDBData:eChainPDB];
    });

    pdbData *fChainPDB = [[pdbData alloc] init];
    modelObject *fChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [fChainPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        fChainPDB.CPK = NO;
        fChainPDB.hydrophobic = YES;
        [fChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_h.pdb"];
        
        [fChain setModelWithPDBData:fChainPDB];
    });

    pdbData *gChainPDB = [[pdbData alloc] init];
    modelObject *gChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [gChainPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        gChainPDB.CPK = NO;
        gChainPDB.hydrophobic = YES;
        [gChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_t.pdb"];
        
        [gChain setModelWithPDBData:gChainPDB];
    });

    pdbData *hChainPDB = [[pdbData alloc] init];
    modelObject *hChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [hChainPDB setDiffuseColour:subCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        hChainPDB.CPK = NO;
        hChainPDB.hydrophobic = YES;
        [hChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_z.pdb"];
        
        [hChain setModelWithPDBData:hChainPDB];
    });

    pdbData *iChainPDB = [[pdbData alloc] init];
    modelObject *iChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [iChainPDB setDiffuseColour:subCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        iChainPDB.CPK = NO;
        iChainPDB.hydrophobic = YES;
        [iChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_first.pdb"];
        
        [iChain setModelWithPDBData:iChainPDB];
    });

    pdbData *jChainPDB = [[pdbData alloc] init];
    modelObject *jChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [jChainPDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        jChainPDB.CPK = NO;
        jChainPDB.hydrophobic = YES;
        [jChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BiosForMap/CCT_second.pdb"];
        
        [jChain setModelWithPDBData:jChainPDB];
    });

    pdbData *kChainPDB = [[pdbData alloc] init];
    modelObject *kChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [kChainPDB setDiffuseColour:com1Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        kChainPDB.CPK = NO;
        [kChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/kChain.pdb"];
        
        [kChain setModelWithPDBData:kChainPDB];
    });

    pdbData *lChainPDB = [[pdbData alloc] init];
    modelObject *lChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [lChainPDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        lChainPDB.CPK = NO;
        [lChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/lChain.pdb"];
        
        [lChain setModelWithPDBData:lChainPDB];
    });

    pdbData *mChainPDB = [[pdbData alloc] init];
    modelObject *mChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [mChainPDB setDiffuseColour:com1Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        mChainPDB.CPK = NO;
        [mChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/mChain.pdb"];
        
        [mChain setModelWithPDBData:mChainPDB];
    });

    pdbData *nChainPDB = [[pdbData alloc] init];
    modelObject *nChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [nChainPDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        nChainPDB.CPK = NO;
        [nChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/nChain.pdb"];
        
        [nChain setModelWithPDBData:nChainPDB];
    });

    pdbData *oChainPDB = [[pdbData alloc] init];
    modelObject *oChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [oChainPDB setDiffuseColour:com1Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        oChainPDB.CPK = NO;
        [oChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/oChain.pdb"];
        
        [oChain setModelWithPDBData:oChainPDB];
    });

    pdbData *pChainPDB = [[pdbData alloc] init];
    modelObject *pChain = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [pChainPDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        pChainPDB.CPK = NO;
        [pChainPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/tf55AB/pChain.pdb"];
        
        [pChain setModelWithPDBData:pChainPDB];
    });*/

    dispatch_group_wait(_dispatch_group, DISPATCH_TIME_FOREVER);

    
    Vector rotationAxis, rotationTranslation;
    float rotationAngle;
    Vector zAxis; zAxis.x = zAxis.y = zAxis.w = 0.0; zAxis.w = 1.0;
    Vector yAxis; yAxis.x = yAxis.z = yAxis.w = 0.0; yAxis.y = 1.0;
    Vector xAxis; xAxis.y = xAxis.z = xAxis.w = 0.0; xAxis.x = 1.0;
    
//    [iChain targetMolecule:jChain requiredRotationAxis:&rotationAxis requiredRotationAngle:&rotationAngle requiredTranslationVector:&rotationTranslation];
    
    modelObject *chap = [[modelObject alloc] init];
    [chap addChildModel:aChain];
    [chap addChildModel:bChain];
    [chap addChildModel:cChain];
    /*[chap addChildModel:dChain];
    [chap addChildModel:eChain];
    [chap addChildModel:fChain];
    [chap addChildModel:gChain];
    [chap addChildModel:hChain];
    [chap addChildModel:iChain];
    [chap addChildModel:jChain];
    [chap addChildModel:kChain];
    [chap addChildModel:lChain];
    [chap addChildModel:mChain];
    [chap addChildModel:nChain];
    [chap addChildModel:oChain];
    [chap addChildModel:pChain];*/
    
    [chap centerModelOnCenterOfMass];
//    Vector rotAxis = vector_cross(rotationAxis, yAxis);
//    float rotAngle = acos(vector_dot_product(yAxis, rotationAxis));
//    [chap rotateAroundVector:rotAxis byAngle:rotAngle];
    [chap rotateAroundX:90 * radiansPerDegree Y:0 Z:0];
    [chap centerModelOnCenterOfMass];
    
//    modelObject *rotChap = [[modelObject alloc] init];
//    [rotChap addChildModel:chap];
//    [rotChap centerModelOnCenterOfMass];
//    rotAxis = vector_cross(rotationAxis, xAxis);
//    rotAngle = acos(vector_dot_product(xAxis, rotationAxis));
//    [rotChap rotateAroundVector:rotAxis byAngle:rotAngle];
    
    
    modelObject *centeredChap = [[modelObject alloc] init];
    [centeredChap addChildModel:chap];
    [centeredChap centerModelOnCenterOfMass];
    
    modelObject *newWorld = [[modelObject alloc] init];
    [newWorld addChildModel:centeredChap];
    
    return newWorld;
    
}

- (modelObject *)loadSceneATPase {
//    NSLog(@"Loading data");
    

//    Complex 1
    /*pdbData *com1PDB = [[pdbData alloc] init];
    modelObject *com1 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [com1PDB setDiffuseColour:com1Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        com1PDB.CPK = NO;
        [com1PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Supercomplex/com1.pdb"];
        
        [com1 setModelWithPDBData:com1PDB];
        [com1 enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });
    
    //    Complex 3
    pdbData *com3PDB = [[pdbData alloc] init];
    modelObject *com3 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [com3PDB setDiffuseColour:com3Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        com3PDB.CPK = NO;
        [com3PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Supercomplex/com3.pdb"];
        
        [com3 setModelWithPDBData:com3PDB];
        [com3 enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });

    //    Complex 4
    pdbData *com4PDB = [[pdbData alloc] init];
    modelObject *com4 = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [com4PDB setDiffuseColour:com4Colour specularColour:specColour shininess:5 mirrorFrac:0.0];
        com4PDB.CPK = NO;
        [com4PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Supercomplex/com4.pdb"];
    
        [com4 setModelWithPDBData:com4PDB];
        [com4 enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });
    
    //    Cytochrome C
    pdbData *cytoCPDB = [[pdbData alloc] init];
    modelObject *cytoC = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [cytoCPDB setDiffuseColour:cytoCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        cytoCPDB.CPK = NO;
        [cytoCPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Supercomplex/cytoC.pdb"];
        
        [cytoC setModelWithPDBData:cytoCPDB];
        [cytoC enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });*/


    
    //Subunit M
    pdbData *subMPDB = [[pdbData alloc] init];
    modelObject *subM = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [subMPDB setDiffuseColour:subMColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subMPDB.CPK = NO;
        [subMPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubM.pdb"];
        
        [subM setModelWithPDBData:subMPDB];
        [subM enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];
    });
    
    //Subunit A
    pdbData *subAaPDB = [[pdbData alloc] init];
    modelObject *subAa = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAaPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAaPDB.CPK = NO;
        [subAaPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAa.pdb"];
        subAaPDB.numStates = 180;
        [subAa setModelWithPDBData:subAaPDB];
//        [subAa animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subAbPDB = [[pdbData alloc] init];
    modelObject *subAb = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAbPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAbPDB.CPK = NO;
        [subAbPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAb.pdb"];
        subAbPDB.numStates = 180;
        [subAb setModelWithPDBData:subAbPDB];
//        [subAb animateModelStateWithInitialOffset:0 initialSpeed:0];
    });

    pdbData *subAcPDB = [[pdbData alloc] init];
    modelObject *subAc = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subAcPDB setDiffuseColour:subAColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subAcPDB.CPK = NO;
        [subAcPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubAc.pdb"];
        subAcPDB.numStates = 180;
        [subAc setModelWithPDBData:subAcPDB];
//        [subAc animateModelStateWithInitialOffset:0 initialSpeed:0];
    });

    //Subunit B
    pdbData *subBaPDB = [[pdbData alloc] init];
    modelObject *subBa = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBaPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBaPDB.CPK = NO;
        [subBaPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubBa.pdb"];
        subBaPDB.numStates = 180;
        [subBa setModelWithPDBData:subBaPDB];
//        [subBa animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subBbPDB = [[pdbData alloc] init];
    modelObject *subBb = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBbPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBbPDB.CPK = NO;
        [subBbPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subBb.pdb"];
        subBbPDB.numStates = 180;
        [subBb setModelWithPDBData:subBbPDB];
//        [subBb animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *subBcPDB = [[pdbData alloc] init];
    modelObject *subBc = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subBcPDB setDiffuseColour:subBColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subBcPDB.CPK = NO;
        [subBcPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subBc.pdb"];
        subBcPDB.numStates = 180;
        [subBc setModelWithPDBData:subBcPDB];
//        [subBc animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit C
    pdbData *subCPDB = [[pdbData alloc] init];
    modelObject *subC = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subCPDB setDiffuseColour:subCColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subCPDB.CPK = NO;
        [subCPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubC.pdb"];
        subCPDB.numStates = 180;
        [subC setModelWithPDBData:subCPDB];
//        [subC animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit G
    pdbData *subGPDB = [[pdbData alloc] init];
    modelObject *subG = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subGPDB setDiffuseColour:subGColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subGPDB.CPK = NO;
        [subGPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubG.pdb"];
        subGPDB.numStates = 180;
        [subG setModelWithPDBData:subGPDB];
//        [subG animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit D
    pdbData *subDPDB = [[pdbData alloc] init];
    modelObject *subD = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subDPDB setDiffuseColour:subDColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subDPDB.CPK = NO;
        [subDPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/SubD.pdb"];
        subDPDB.numStates = 180;
        [subD setModelWithPDBData:subDPDB];
//        [subD animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    //Subunit E
    pdbData *subEPDB = [[pdbData alloc] init];
    modelObject *subE = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        [subEPDB setDiffuseColour:subEColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        subEPDB.CPK = NO;
        [subEPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/subE.pdb"];
        subEPDB.numStates = 180;
        [subE setModelWithPDBData:subEPDB];
//        [subE animateModelStateWithInitialOffset:0 initialSpeed:0];
    });
    
    pdbData *stalkPDB = [[pdbData alloc] init];
    modelObject *stalk = [[modelObject alloc] init];
    dispatch_group_async(_dispatch_group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void){
        
        [stalkPDB setDiffuseColour:stalkColour specularColour:specColour shininess:5 mirrorFrac:0.0];
        stalkPDB.CPK = NO;
        [stalkPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/Stalk.pdb"];
        stalkPDB.numStates = 180;
        [stalk setModelWithPDBData:stalkPDB];
//        [stalk animateModelStateWithInitialOffset:0 initialSpeed:0];
    });

    pdbData *protonPDB = [[pdbData alloc] init];
    [protonPDB setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    protonPDB.CPK = NO;
    [protonPDB initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/Hydrogens.pdb"];
    protonPDB.numStates = 180;
    modelObject *protons = [[modelObject alloc] initWithPDBData:protonPDB];
    [protons changeIntrinsicColourTo:protonGlowColour withMaxDistance:10.0 mode:REAL_BROAD_SOURCE];
//    [protons animateModelStateWithInitialOffset:0 initialSpeed:0];
    
    dispatch_group_wait(_dispatch_group, DISPATCH_TIME_FOREVER);

    modelObject *rotor = [[modelObject alloc] init];
    [rotor addChildModel:subC];
    [rotor addChildModel:subD];
    [rotor addChildModel:subE];
    [rotor addChildModel:subG];
    [rotor addChildModel:protons];
    [rotor animateModelStateWithInitialOffset:0 initialSpeed:0.0];
    [rotor enableModelStateWobbleWithMax:5 changeSize:0.5 minChangeSize:2.0];
    
    modelObject *atpase = [[modelObject alloc] init];
    [atpase addChildModel:subAa];
    [atpase addChildModel:subAb];
    [atpase addChildModel:subAc];
    [atpase addChildModel:subBa];
    [atpase addChildModel:subBb];
    [atpase addChildModel:subBc];
    [atpase addChildModel:subM];
    [atpase addChildModel:rotor];
    [atpase addChildModel:stalk];
    [atpase rotateAroundX:90 * radiansPerDegree Y:30 * radiansPerDegree Z:0];
    [atpase enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];
    [atpase animateModelStateWithInitialOffset:0 initialSpeed:0];
//    [atpase animateRotationAroundX:0 Y:180 * radiansPerDegree Z:0 duration:120];
    [atpase setClipForModelTo:YES];
        
    modelObject *atpaseRotate = [[modelObject alloc] init];
    [atpaseRotate addChildModel:atpase];
    [atpaseRotate rotateAroundX:0 Y:180 * radiansPerDegree Z:0];
        
    pdbData *popcData = [[pdbData alloc] init];
    [popcData setDiffuseColour:popcColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    popcData.CPK = NO;
    [popcData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc.pdb"];
    
    modelObject *popc = [[modelObject alloc] initWithPDBData:popcData];
    [popc rotateAroundX:0 Y:0 Z:-11.6 * radiansPerDegree];
    
    modelObject *popcRotate = [[modelObject alloc] init];
    [popcRotate addChildModel:popc];
    [popcRotate rotateAroundX:0 Y:0 Z:180 * radiansPerDegree];
    
    pdbData *popcHeadData = [[pdbData alloc] init];
    [popcHeadData setDiffuseColour:popcColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    popcHeadData.CPK = NO;
    [popcHeadData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc-headOnly.pdb"];
    
    modelObject *popcHead = [[modelObject alloc] initWithPDBData:popcHeadData];
    [popcHead rotateAroundX:0 Y:0 Z:-11.6 * radiansPerDegree];
    
    
    Vector start, end, i1, i2;
    Vector modelOrientation;
    

    modelOrientation.x = 0;
    modelOrientation.y = -1.0;
    modelOrientation.z = 0;
    modelOrientation.w = 0.0;
    /*start.x = -400; start.y = 0; start.z = 0; start.w = 0;
    end.x = 0; end.y = 0; end.z = 0; end.w = 0;
    i1.x = -100; i1.y = 0; i1.z = 0; i1.w = 0;
    i2.x = -50; i2.y = 0; i2.z = 0; i2.w = 0;
//    start.x = -130; start.y = 200; start.z = 0; start.w = 0;
//    i1.x = -120; i1.y = 80; i1.z = 0; i1.w = 0;
//    i2.x = -75; i2.y = 0; i2.z = 0; i2.w = 0;
//    end.x = 0; end.y = 0; end.z = 0; end.w = 0;
    beizerCurve *topCurve = [[beizerCurve alloc] init];
    [topCurve addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    start.x = -2000;
    beizerCurve *topCurveWide = [[beizerCurve alloc] init];
    [topCurveWide addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    end.x = 400; end.y = 0; end.z = 0; end.w = 0;
    i2.x = 100; i2.y = 0; i2.z = 0; i2.w = 0;
//    i2.x = 120; i2.y = 80; i2.z = 0; i2.w = 0;
//    end.x = 130; end.y = 200; end.z = 0; end.w = 0;
    [topCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 2000;
    [topCurveWide addCurveWithSymmetricalJoinWithI2:i2 end:end];
    
//    beizerCurve *topLeftCurve = [topCurve curveBySplittingAtPoint:0.26 startCurve:YES];
//    beizerCurve *topRightCurve = [topCurve curveBySplittingAtPoint:0.72 startCurve:NO];
    beizerCurve *topLeftCurve = [topCurve curveBySplittingAtPoint:0.41 startCurve:YES];
    beizerCurve *topRightCurve = [topCurve curveBySplittingAtPoint:0.67 startCurve:NO];
    
    start.x = -400; start.y = 27; start.z = 0; start.w = 0;
    end.x = 0; end.y = 27; end.z = 0; end.w = 0;
    i1.x = -100; i1.y = 27; i1.z = 0; i1.w = 0;
    i2.x = -50; i2.y = 27; i2.z = 0; i2.w = 0;
//    start.x = -100; start.y = 200; start.z = 0; start.w = 0;
//    i1.x = -92; i1.y = 95; i1.z = 0; i1.w = 0;
//    i2.x = -60; i2.y = 27; i2.z = 0; i2.w = 0;
//    end.x = 0; end.y = 27; end.z = 0; end.w = 0;
    beizerCurve *lowerCurve = [[beizerCurve alloc] init];
    [lowerCurve addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    start.x = -1000;
    beizerCurve *lowerCurveWide = [[beizerCurve alloc] init];
    [lowerCurveWide addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    end.x = 400; end.y = 27; end.z = 0; end.w = 0;
    i2.x = 100; i2.y = 27; i2.z = 0; i2.w = 0;
//    i2.x = 92; i2.y = 95; i2.z = 0; i2.w = 0;
//    end.x = 100; end.y = 200; end.z = 0; end.w = 0;
    [lowerCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 1000;
    [lowerCurveWide addCurveWithSymmetricalJoinWithI2:i2 end:end];
    
//    beizerCurve *lowerLeftCurve = [lowerCurve curveBySplittingAtPoint:0.27 startCurve:YES];
//    beizerCurve *lowerRightCurve = [lowerCurve curveBySplittingAtPoint:0.72 startCurve:NO];
    beizerCurve *lowerLeftCurve = [lowerCurve curveBySplittingAtPoint:0.42 startCurve:YES];
    beizerCurve *lowerRightCurve = [lowerCurve curveBySplittingAtPoint:0.67 startCurve:NO];
    */
    
    //
    //
    /*Used for scene three*/
    //
    //
    //
    /*beizerCurve *scaleCurve = [[beizerCurve alloc] initWithSVGPath:@"M -52.482925,518.74039 -87.90512,485.96341"];
    beizerCurve *outerStartCurve = [[beizerCurve alloc] initWithSVGPath:@"m 0.47727851,-20.337005 c -2.93551401,0.02553 -10.20824501,-0.573562 -15.16363751,-0.104671 -4.955393,0.468891 -11.351981,0.461058 -11.230486,3.478192 0.121495,3.017134 -0.11855,6.202341 -0.11073,8.745324 0.0078,2.5429837 -0.178468,14.0218453 -0.178471,10.5049709 -1e-6,-3.3395257 10.998129,-2.4793534 26.31203051,-2.4792425 15.31390249,1.109e-4 22.68696749,-0.9872228 22.68696949,2.3542732 -2e-6,3.5054507 0.882506,-5.0605543 0.828476,-9.0031016 -0.05403,-3.942547 -0.688098,-5.434727 -0.463036,-10.027649 0.225063,-4.592923 -1.49938,-1.828612 -4.260529,-2.473489 -2.76115,-0.644877 -4.548911,0.270868 -6.877977,-0.377007 -2.3290662,-0.647875 -8.6070955,-0.64313 -11.54260949,-0.6176 z"];
    [outerStartCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    
    beizerCurve *outerEndCurve = [[beizerCurve alloc] initWithSVGPath:@"m 0.04875442,-16.762817 c -25.68224242,0.32147 -19.50193542,9.0548104 -19.31252942,12.0397001 0.189405,2.9848897 2.082896,9.7593154 3.658573,14.4179013 0.878294,2.5967276 12.3412535,10.1157936 12.5989673,6.9770346 0.2577139,-3.138758 -0.067259,-6.118134 -0.067262,-9.6350084 -8e-7,-3.3395257 0.3730688,-7.22924326 3.56203416,-7.22924214 C 3.6774694,-0.19240847 4.0505359,3.6953453 4.0505383,7.0368413 4.0505358,10.542292 4.0480627,12.55955 3.9033555,16.79136 3.7659122,20.810744 14.781711,11.3036 16.685116,7.1190492 c 1.464861,-3.2204336 1.08371,-4.7950701 1.736867,-8.6463243 0.342463,-2.019285 0.33237,-3.9990534 0.546197,-7.1555505 0.213827,-3.1564974 6.762817,-8.4014624 -18.91942558,-8.0799914 z"];
    [outerEndCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    
    beizerCurve *innerStartCurve = [[beizerCurve alloc] initWithSVGPath:@"M -0.25777965,8.9498295 C -3.9609068,8.8969315 1.6535974,9.4297505 -11.005785,8.3667185 c -5.678916,-1.501303 -1.720611,-0.647603 -6.999172,-1.485011 -4.857102,-0.770547 -1.842698,0.3666868 -4.732955,-1.4828592 -2.652673,-1.6975105 -2.368116,0.1481071 -2.585582,-3.3620374 -0.176778,-2.85338981 10.310599,-2.22924244 25.81203116,-2.22924244 15.50143184,0 21.35747584,-0.66126997 21.24949884,2.35427314 -0.107976,3.0155432 0.07334,1.9168122 -0.443232,2.5851008 -0.516576,0.6682885 -1.074657,0.3575077 -2.569636,1.0195001 -1.494979,0.6619923 -0.704598,0.032247 -4.365294,1.39536 -4.7840606,1.781414 -1.171624,0.250731 -6.0053923,1.038101 -11.294842,0.983738 -4.9091341,0.802824 -8.61226135,0.749926 z"];
    //    Vector crist; crist.x = -30; crist.y = -153; crist.z = 0; crist.w = 1.0;
    //    Vector crist; crist.x = -39; crist.y = -143; crist.z = 0; crist.w = 1.0;
    //    float tForATP = [innerCurve tValueClosestToPoint:crist withResolution:1.0];
    [innerStartCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    //    beizerCurve *temp = [innerStartCurve curveB]
    
    beizerCurve *innerEndCurve = [[beizerCurve alloc] initWithSVGPath:@"M 0.48073496,16.802381 C -3.7527157,16.572706 -2.8318609,16.215274 -2.8343976,15.336649 c -0.00254,-0.878625 -0.059619,0.422257 -0.063698,-1.011029 -0.00408,-1.433287 -0.069087,0.118904 -0.1813627,-2.095743 -0.1122751,-2.214646 0.00596,-1.676192 0.00596,-5.1930664 -8e-7,-3.3395257 0.3730688,-7.22924326 3.56203416,-7.22924214 3.18893224,2.307e-5 3.56199874,3.88777684 3.56200114,7.22927284 -2.5e-6,3.5054507 -0.089159,1.3066953 -0.058795,2.1531209 0.030365,0.8464258 0.145604,1.2623038 0.00403,2.3172808 -0.1415714,1.054977 0.043447,0.814457 0.032363,1.979754 -0.011084,1.165296 -0.036349,0.495742 -0.057356,1.483089 -0.021008,0.987347 0.7434028,2.06197 -3.49004794,1.832295 z"];
    
    [innerEndCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];*/
    
    beizerCurve *scaleCurve = [[beizerCurve alloc] initWithSVGPath:@"M -52.482925,518.74039 -87.90512,485.96341"];
    beizerCurve *outerStartCurve = [[beizerCurve alloc] initWithSVGPath:@"m 3.8598608,-132.087 c -103.9355008,2.77552 -102.4582338,63.926435 -103.1636338,71.145326 -0.705387,7.218891 -0.828477,12.610648 -0.980487,19.728191 -0.105,4.916724 -1.11855,33.7023395 0.13927,36.495323 1.257809,2.7929836 10.321532,10.5218453 10.321529,7.0049709 -1e-6,-3.3395257 87.1230628,-2.47924356 90.31202816,-2.47924244 3.18890224,2.307e-5 86.43696384,-0.73722288 86.43696584,2.60427314 -2e-6,3.5054507 7.932381,-7.1374193 9.078476,-11.2531014 1.745846,-6.2694122 0.819468,-12.4543732 1.286964,-17.0276492 0.982629,-9.612569 0.604232,-8.569582 0.73947,-12.473488 0.342463,-9.885848 -0.298911,-6.229131 0.122023,-17.627006 C 98.5734,-67.367277 107.79537,-134.86253 3.8598608,-132.087 z"];
    [outerStartCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    
    beizerCurve *outerEndCurve = [[beizerCurve alloc] initWithSVGPath:@"M -5.3325269,-63.674427 C -243.26476,-51.352957 -9.341199,102.11314 -8.2637759,65.27688 -8.4626146,60.593597 -5.733495,46.598055 -5.355202,41.694783 c 0.3782933,-4.903272 2.0028652,-17.288011 2.260579,-20.42677 0.2577139,-3.138758 0.021129,-10.714328 0.021126,-14.2312024 -8e-7,-3.3395257 0.3730688,-7.22924326 3.56203416,-7.22924214 C 3.6774694,-0.19240847 4.0505359,3.6953453 4.0505383,7.0368413 4.0505358,10.542292 4.3132277,14.15054 3.7265788,18.38235 3.1743275,22.365986 2.970254,30.589482 2.1851162,35.119048 1.3999781,39.648614 1.698226,46.673544 1.8639259,50.576276 2.0296118,54.47901 0.10220273,64.335258 0.21818119,67.067171 -0.47005992,99.517158 232.59971,-75.995897 -5.3325269,-63.674427 z"];
    [outerEndCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    
    beizerCurve *innerStartCurve = [[beizerCurve alloc] initWithSVGPath:@"M -0.38277964,20.824829 C -4.0859068,20.771931 -12.346402,21.67975 -24.880784,19.491718 -30.5597,17.990415 -39.851395,18.844115 -45.129956,18.006707 -49.987058,17.23616 -60.097653,13.623394 -64.61291,11.898848 -67.554946,10.775174 -89.823488,5.8036853 -89.823491,2.2868109 c -10e-7,-3.3395257 87.1230628,-2.47924356 90.31202816,-2.47924244 3.18893224,2.307e-5 86.43699384,-0.73722288 86.43699584,2.60427314 -2e-6,3.5054507 -17.110341,7.2872338 -20.443231,9.9601004 -3.203901,2.569423 -5.22971,1.732974 -9.319636,3.832 -5.381332,2.7618 -7.267097,1.719747 -10.927793,3.08286 -4.784061,1.781414 -17.671624,0.500731 -22.505392,1.288101 -11.294842,0.983738 -20.4091334,0.302824 -24.11226064,0.249926 z"];
    //    Vector crist; crist.x = -30; crist.y = -153; crist.z = 0; crist.w = 1.0;
    //    Vector crist; crist.x = -39; crist.y = -143; crist.z = 0; crist.w = 1.0;
    //    float tForATP = [innerCurve tValueClosestToPoint:crist withResolution:1.0];
    [innerStartCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];
    //    beizerCurve *temp = [innerStartCurve curveB]
    
    beizerCurve *innerEndCurve = [[beizerCurve alloc] initWithSVGPath:@"M -5.5093036,97.015581 C -9.7427543,96.785906 -9.341199,102.11314 -8.2637759,65.27688 -8.4626146,60.593597 -5.733495,46.598055 -5.355202,41.694783 c 0.3782933,-4.903272 2.0028652,-17.288011 2.260579,-20.42677 0.2577139,-3.138758 0.021129,-10.714328 0.021126,-14.2312024 -8e-7,-3.3395257 0.3730688,-7.22924326 3.56203416,-7.22924214 C 3.6774694,-0.19240847 4.0505359,3.6953453 4.0505383,7.0368413 4.0505358,10.542292 4.3132277,14.15054 3.7265788,18.38235 3.1743275,22.365986 2.970254,30.589482 2.1851162,35.119048 1.3999781,39.648614 1.698226,46.673544 1.8639259,50.576276 2.0296118,54.47901 0.10220273,64.335258 0.21818119,67.067171 -0.47005992,99.517158 -1.2758529,97.245256 -5.5093036,97.015581 z"];
    
    [innerEndCurve scaleWithScaleCurve:scaleCurve scaleLengthAngstroms:1000];

    
    beizerCurve *tempCurve = [innerStartCurve curveBySplittingAtPoint:0.35 startCurve:NO];
    beizerCurve *innerStartCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.4 startCurve:YES];
//    beizerCurve *tempCurve = [innerStartCurve curveBySplittingAtPoint:0.43 startCurve:NO];
//    beizerCurve *innerStartCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.18 startCurve:YES];
    /*Used for scene three*/
//    beizerCurve *tempCurve = [innerStartCurve curveBySplittingAtPoint:0.42 startCurve:NO];
//    beizerCurve *innerStartCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.195 startCurve:YES];

    tempCurve = [innerEndCurve curveBySplittingAtPoint:0.35 startCurve:NO];
    beizerCurve *innerEndCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.4 startCurve:YES];
//    tempCurve = [innerEndCurve curveBySplittingAtPoint:0.43 startCurve:NO];
//    beizerCurve *innerEndCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.18 startCurve:YES];
    /*Used for scene three*/
//    tempCurve = [innerEndCurve curveBySplittingAtPoint:0.42 startCurve:NO];
//    beizerCurve *innerEndCurveForMembrane = [tempCurve curveBySplittingAtPoint:0.195 startCurve:YES];

    pdbData *protonData = [[pdbData alloc] init];
    [protonData setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    protonData.CPK = NO;
    [protonData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/proton.pdb"];
    
    modelObject *protonNoGlow = [[modelObject alloc] initWithPDBData:protonData];
    [protonNoGlow changeDiffuseColourTo:atpColour];
    
    Vector gridDirection;
    gridDirection.x = 0;
    gridDirection.y = 0;
    gridDirection.z = 1.0;
    gridDirection.w = 0.0;
    beizerCurve *outerInsideCurve = [outerStartCurve curveBySubtractingNormalWithScale:28.0 segmentations:4 crossVector:gridDirection];
    beizerCurve *innerInsideCurve = [innerStartCurveForMembrane curveBySubtractingNormalWithScale:28.0 segmentations:4 crossVector:gridDirection];
    beizerCurve *innerEndInsideCurve = [innerEndCurveForMembrane curveBySubtractingNormalWithScale:28.0 segmentations:4 crossVector:gridDirection];
    
    beizerCurve *innerBoundaryCurve = [innerStartCurve curveBySubtractingNormalWithScale:35.0 segmentations:4 crossVector:gridDirection];
    beizerCurve *innerEndBoundaryCurve = [innerEndCurve curveBySubtractingNormalWithScale:35.0 segmentations:4 crossVector:gridDirection];
    
//    modelObject *OMpopCCurve = [[modelObject alloc] init];
//    modelObject *OMpopCCurveInner = [[modelObject alloc] init];
//    [OMpopCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:outerCurve];
//    [OMpopCCurveInner addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:outerInsideCurve];

    modelObject *IMpopCCurve = [[modelObject alloc] init];
    modelObject *IMpopCCurveInner = [[modelObject alloc] init];
//    modelObject *protonBoundary = [[modelObject alloc] init];
    modelObject *IMpopCCurveHeadOnly = [[modelObject alloc] init];
    [IMpopCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerStartCurveForMembrane];
    [IMpopCCurveInner addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerInsideCurve];
//    [protonBoundary addParametricLineOfModel:protonNoGlow modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerBoundaryCurve];
    [IMpopCCurveHeadOnly addParametricLineOfModel:popcHead modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:innerStartCurveForMembrane];

    Vector attachPoint;
    attachPoint.x = 0;
    attachPoint.y = -47;
    attachPoint.z = 0;
    attachPoint.w = 1.0;
    
    modelObject *atpaseLeft = [[modelObject alloc] init];
    [atpaseLeft addChildModel:atpaseRotate onToCurve:innerStartCurve curveFraction:0.453 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
//    [atpaseLeft enableWobbleWithMaxRadius:0.3 changeVectorSize:0.05];
    [atpaseLeft setName:@"childATPase" forChild:atpaseRotate];
//    [atpaseLeft addChildModel:atpaseRotate onToCurve:topCurve curveFraction:0.32 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
//    [atpaseLeft changeDiffuseColourTo:subAColour];
//    [atpaseLeft setClipForModelTo:NO];
    
//    modelObject *atpaseRight = [[modelObject alloc] init];
//    [atpaseRight addChildModel:atpase onToCurve:topCurve curveFraction:0.68 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
//    [atpaseRight addChildModel:atpase onToCurve:topCurve curveFraction:0.99 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
//    [atpaseRight enableWobbleWithMaxRadius:0.3 changeVectorSize:0.05];
//    [atpaseRight setName:@"childATPase" forChild:atpase];
    
    attachPoint.x = 0;
    attachPoint.y = 0;
    attachPoint.z = 0;
    attachPoint.w = 1.0;
    
    modelOrientation.x = 1;
    modelOrientation.y = 0;
    modelOrientation.z = 0;
    modelOrientation.w = 0.0;
    
//    modelObject *precomplex = [[modelObject alloc] init];
//    [precomplex addChildModel:com1];
//    [precomplex addChildModel:com3];
//    [precomplex addChildModel:com4];
//    [precomplex addChildModel:cytoC];
    
//    [precomplex centerModelOnOrigin];
    
//    modelObject *supercomplex = [[modelObject alloc] init];
//    [supercomplex addChildModel:precomplex onToCurve:topCurve curveFraction:0.7 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
    
    modelOrientation.x = 0;
    modelOrientation.y = -1.0;
    modelOrientation.z = 0;
    modelOrientation.w = 0.0;
    
/*    modelObject *popCCurve = [[modelObject alloc] init];
    modelObject *popCCurveLower = [[modelObject alloc] init];
    [popCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:topCurve];
//    [popCCurve translateToX:0 Y:0 Z:12];
//    [popCCurve enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    [popCCurveLower addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:3.0 bezierCurve:lowerCurve];
//    [popCCurveLower translateToX:0 Y:0 Z:12];
//    [popCCurveLower enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    
    modelObject *popCCurveHeadOnly = [[modelObject alloc] init];
    [popCCurveHeadOnly addParametricLineOfModel:popcHead modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:topCurveWide];

//    modelObject *popCHeadFirstGrid = [[modelObject alloc] init];
//    [popCHeadFirstGrid addGridOfModel:popCCurveHeadOnly xNumMembers:1 xSpacing:0 zNumMembers:20 zSpacing:6.0];
    
//    modelObject *popCHeadGrid = [[modelObject alloc] init];
//    [popCHeadGrid addGridOfModel:popCHeadFirstGrid xNumMembers:1 xSpacing:0 zNumMembers:6 zSpacing:120.0];
//    [popCHeadGrid translateToX:0 Y:0 Z:18];
    
    modelObject *popCCurveLeft = [[modelObject alloc] init];
    [popCCurveLeft addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:topLeftCurve];
//    [popCCurveLeft enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    modelObject *popCCurveLowerLeft = [[modelObject alloc] init];
    [popCCurveLeft addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:lowerLeftCurve];
//    [popCCurveLeft enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    modelObject *popCCurveRight = [[modelObject alloc] init];
    [popCCurveRight addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:topRightCurve];
//    [popCCurveRight enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    modelObject *popCCurveLowerRight = [[modelObject alloc] init];
    [popCCurveLowerRight addParametricLineOfModel:popcRotate modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:lowerRightCurve];
//    [popCCurveLowerRight enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];*/
    
    modelObject *membranePlane = [[modelObject alloc] init];
//    [membranePlane addGridOfModel:popCCurve xNumMembers:1 xSpacing:0 zNumMembers:3 zSpacing:6];
//    [membranePlane addGridOfModel:popCCurveLower xNumMembers:1 xSpacing:0 zNumMembers:3 zSpacing:6];
//    [membranePlane addChildModel:popCHeadGrid];
//    [membranePlane addGridOfModel:OMpopCCurve xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
//    [membranePlane addGridOfModel:OMpopCCurveInner xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [membranePlane addGridOfModel:IMpopCCurve xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [membranePlane addGridOfModel:IMpopCCurveInner xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [membranePlane translateToX:0 Y:0 Z:24];
    
    modelObject *membrane = [[modelObject alloc] init];
//    [membrane addChildModel:popCCurveLeft];
//    [membrane addChildModel:popCCurveLowerLeft];
//    [membrane addGridOfModel:popCCurveLeft xNumMembers:1 xSpacing:0 zNumMembers:4 zSpacing:6.0];
//    [membrane addGridOfModel:popCCurveLowerLeft xNumMembers:1 xSpacing:0 zNumMembers:4 zSpacing:6.0];
//    [membrane addGridOfModel:popCCurveRight xNumMembers:1 xSpacing:0 zNumMembers:4 zSpacing:6.0];
//    [membrane addGridOfModel:popCCurveLowerRight xNumMembers:1 xSpacing:0 zNumMembers:4 zSpacing:6.0];
    [membrane addChildModel:membranePlane];
//    [membrane addGridOfModel:protonBoundary xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    [membrane enableWobbleWithMaxRadius:0.5 changeVectorSize:0.3];
    
    modelObject *proton = [[modelObject alloc] initWithPDBData:protonData];
    [proton changeIntrinsicColourTo:protonGlowColour withMaxDistance:10.0 mode:REAL_POINT_SOURCE];
    [proton centerModelOnOrigin];
    [proton setClipForModelTo:YES];
    
    Vector c1, c2, e1;
    c1.x = -400; c1.y = 30; c1.z = -100; c1.w = 0;
    c2.x = 400; c2.y = 150; c2.z = 100; c2.w = 0;
//    c1.x = -400; c1.y = 150; c1.z = -100; c1.w = 0;
//    c2.x = 400; c2.y = 250; c2.z = 100; c2.w = 0;
    e1.x = 0; e1.y = 300; e1.z = 100; e1.w = 0;
    
    modelObject *protonPool = [[modelObject alloc] init];
    [protonPool setupCurveBasedPoolOfModel:proton numModels:100 boundingCurve:innerBoundaryCurve innerCurve:nil nearZLimit:0 farZLimit:200 newModelEntryPoint:e1];
//    [protonPool setupPoolOfModel:proton numModels:100 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [protonPool enablePoolDiffusionWithMaxTransSpeed:5.0 maxRotSpeed:0.0 transChangeSize:1.5 rotChangeSize:0.00];
    [protonPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    [protonPool changePoolReplacementTo:YES];

    modelObject *matrixPool = [[modelObject alloc] init];
    c1.x = -1500; c1.y = -30; c1.z = 0; c1.w = 0;
    c2.x = 1500; c2.y = -600; c2.z = 1000; c2.w = 0;
    e1.x = 200; e1.y = 320; e1.z = 0; e1.w = 0;
    [matrixPool setupCurveBasedPoolOfModel:proton numModels:2 boundingCurve:outerStartCurve innerCurve:nil nearZLimit:0 farZLimit:200 newModelEntryPoint:e1];
//    [matrixPool setupPoolOfModel:proton numModels:0 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [matrixPool enablePoolDiffusionWithMaxTransSpeed:5.0 maxRotSpeed:0.1 transChangeSize:1.5 rotChangeSize:0.01];
    [matrixPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    
    pdbData *adpPDB = [[pdbData alloc] init];
//    [adpPDB setDiffuseR:247/255.0 diffuseG:236/255.0 diffuseB:161/255.0 specR:0.6 specG:0.6 specB:0.6 shininess:5 mirrorFrac:0.0];
    [adpPDB setDiffuseColour:adpColour specularColour:specColour shininess:5.0 mirrorFrac:0.0];
    adpPDB.CPK = NO;
    [adpPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/ADP_2.pdb"];
    modelObject *adpNoO = [[modelObject alloc] initWithPDBData:adpPDB];

    pdbData *adpoPDB = [[pdbData alloc] init];
    adpoPDB.CPK = NO;
    [adpoPDB setDiffuseColour:adpColour specularColour:specColour shininess:5.0 mirrorFrac:0.0];
    [adpoPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/ADP_O.pdb"];
    modelObject *adpo = [[modelObject alloc] initWithPDBData:adpoPDB];

    pdbData *po4PDB = [[pdbData alloc] init];
    po4PDB.CPK = NO;
//    [po4PDB setDiffuseR:247/255.0 diffuseG:236/255.0 diffuseB:161/255.0 specR:0.6 specG:0.6 specB:0.6 shininess:5 mirrorFrac:0.0];
    [po4PDB setDiffuseColour:po4Colour specularColour:specColour shininess:5.0 mirrorFrac:0.0];
    [po4PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4.pdb"];
    modelObject *po4NoO = [[modelObject alloc] initWithPDBData:po4PDB];
    
    pdbData *po4OPDB = [[pdbData alloc] init];
    po4OPDB.CPK = NO;
    [po4OPDB setDiffuseColour:po4Colour specularColour:specColour shininess:5.0 mirrorFrac:0.0];
    [po4OPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4_O.pdb"];
    modelObject *po4O = [[modelObject alloc] initWithPDBData:po4OPDB];

    modelObject *adp = [[modelObject alloc] init];
    [adp addChildModel:adpNoO];
    [adp addChildModel:adpo];
    [adp centerModelOnCenterOfMass];
    [adp changeDiffuseColourTo:adpColour];
    [adp setClipForModelTo:YES];
    modelObject *po4 = [[modelObject alloc] init];
    [po4 addChildModel:po4NoO];
    [po4 addChildModel:po4O];
    [po4 setName:@"O4" forChild:po4O];
    [po4 centerModelOnCenterOfMass];
    [po4 setClipForModelTo:YES];
    
    modelObject *po4CNoO = [[modelObject alloc] init];
    [po4CNoO addChildModel:po4NoO];
    [po4CNoO addChildModel:po4O];
    [po4CNoO centerModelOnCenterOfMass];
    [po4CNoO deleteChildModel:po4O];
    [po4CNoO changeDiffuseColourTo:po4Colour];
    [po4CNoO setClipForModelTo:YES];

    modelObject *adpNC = [[modelObject alloc] initWithPDBData:adpPDB];
    [adpNC changeDiffuseColourTo:protonColour];

//    RGBColour po4GlowColour; po4GlowColour.red = 1.0; po4GlowColour.green = 1.0; po4GlowColour.blue = 0.8;
    pdbData *po4NCPDB = [[pdbData alloc] init];
    po4NCPDB.CPK = NO;
    [po4NCPDB setDiffuseColour:protonColour specularColour:specColour shininess:5 mirrorFrac:0.0];
    [po4NCPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4.pdb"];
    modelObject *po4NC = [[modelObject alloc] initWithPDBData:po4PDB];
//    [po4NC changeIntrinsicColourTo:protonGlowColour withMaxDistance:5.0 mode:REAL_BROAD_SOURCE];
    
    modelObject *atp = [[modelObject alloc] init];
    [atp addChildModel:adpNC];
    [atp addChildModel:po4NC];
    [atp centerModelOnCenterOfMass];
    [atp changeDiffuseColourTo:atpColour];
    [atp setClipForModelTo:YES];
    
    modelObject *atpGlow = [[modelObject alloc] init];
    [atpGlow addChildModel:adpNC];
    [atpGlow addChildModel:po4NC];
    [atpGlow centerModelOnCenterOfMass];
    [atpGlow changeDiffuseColourTo:atpGlowDiffuseColour];
    [atpGlow changeIntrinsicColourTo:atpGlowColour withMaxDistance:10.0 mode:REAL_BROAD_SOURCE];
    [atpGlow setClipForModelTo:YES];

    modelObject *matrixADPPool = [[modelObject alloc] init];
    modelObject *matrixPO4Pool = [[modelObject alloc] init];
    modelObject *matrixATPPool = [[modelObject alloc] init];
//    c1.x = -61; c1.y = -178; c1.z = -60; c1.w = 0;
//    c2.x = 75; c2.y = 63; c2.z = 63; c2.w = 0;
//    [matrixADPPool addPoolExclusionZoneWithBoundingCorner1:c1 boundingCorner2:c2];
//    [matrixPO4Pool addPoolExclusionZoneWithBoundingCorner1:c1 boundingCorner2:c2];
//    [matrixATPPool addPoolExclusionZoneWithBoundingCorner1:c1 boundingCorner2:c2];
    //Add exclusion zones
    //Need to apply transformations to target models first
    [atpaseLeft applyTransformation];
    [matrixADPPool addPoolExclusionZoneBasedOn:atpaseLeft];
    [matrixPO4Pool addPoolExclusionZoneBasedOn:atpaseLeft];
    [matrixATPPool addPoolExclusionZoneBasedOn:atpaseLeft];
    [matrixPool addPoolExclusionZoneBasedOn:atpaseLeft];
//    [atpaseRight applyTransformation];
//    [matrixADPPool addPoolExclusionZoneBasedOn:atpaseRight];
//    [matrixPO4Pool addPoolExclusionZoneBasedOn:atpaseRight];
//    [matrixATPPool addPoolExclusionZoneBasedOn:atpaseRight];
//    [matrixPool addPoolExclusionZoneBasedOn:atpaseRight];
    
    c1.x = -400; c1.y = -30; c1.z = -100; c1.w = 0;
    c2.x = 400; c2.y = -400; c2.z = 500; c2.w = 0;
    e1.x = 0; e1.y = -400; e1.z = 500; e1.w = 0;
//    [matrixADPPool setupPoolOfModel:adp numModels:50 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [matrixADPPool setupCurveBasedPoolOfModel:adp numModels:20 boundingCurve:outerStartCurve innerCurve:nil nearZLimit:-100 farZLimit:200 newModelEntryPoint:e1];
    [matrixADPPool enablePoolDiffusionWithMaxTransSpeed:3.0 maxRotSpeed:0.1 transChangeSize:0.5 rotChangeSize:0.01];
    [matrixADPPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    [matrixADPPool changePoolReplacementTo:YES];
//    [matrixPO4Pool setupPoolOfModel:po4 numModels:50 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [matrixPO4Pool setupCurveBasedPoolOfModel:po4 numModels:20 boundingCurve:outerStartCurve innerCurve:nil nearZLimit:-100 farZLimit:200 newModelEntryPoint:e1];
    [matrixPO4Pool enablePoolDiffusionWithMaxTransSpeed:3.0 maxRotSpeed:0.1 transChangeSize:0.5 rotChangeSize:0.01];
    [matrixPO4Pool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    [matrixPO4Pool changePoolReplacementTo:YES];
//    [matrixATPPool setupPoolOfModel:atpGlow numModels:10 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [matrixATPPool setupCurveBasedPoolOfModel:atpGlow numModels:2 boundingCurve:outerStartCurve innerCurve:nil nearZLimit:-100 farZLimit:200 newModelEntryPoint:e1];
    [matrixATPPool enablePoolDiffusionWithMaxTransSpeed:3.0 maxRotSpeed:0.1 transChangeSize:0.5 rotChangeSize:0.01];
    [matrixATPPool enableWobbleWithMaxRadius:1.0 changeVectorSize:0.5];
    [matrixATPPool changePoolReplacementTo:NO];

    //Load the model state molecules for superpositions
    pdbData *ADPh_0_PDB = [[pdbData alloc] init];
    ADPh_0_PDB.CPK = YES;
    [ADPh_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_ADPh.pdb"];
    modelObject *ADPh_0 = [[modelObject alloc] initWithPDBData:ADPh_0_PDB];
    
    pdbData *PO4h_0_PDB = [[pdbData alloc] init];
    PO4h_0_PDB.CPK = YES;
    [PO4h_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_PO4h.pdb"];
    modelObject *PO4h_0 = [[modelObject alloc] initWithPDBData:PO4h_0_PDB];

    pdbData *ADPe_0_PDB = [[pdbData alloc] init];
    ADPe_0_PDB.CPK = YES;
    [ADPe_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_ADPe.pdb"];
    modelObject *ADPe_0 = [[modelObject alloc] initWithPDBData:ADPe_0_PDB];

    pdbData *PO4e_0_PDB = [[pdbData alloc] init];
    PO4e_0_PDB.CPK = YES;
    [PO4e_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_PO4e.pdb"];
    modelObject *PO4e_0 = [[modelObject alloc] initWithPDBData:PO4e_0_PDB];

    pdbData *ADPb_0_PDB = [[pdbData alloc] init];
    ADPb_0_PDB.CPK = YES;
    [ADPb_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_ADPb.pdb"];
    modelObject *ADPb_0 = [[modelObject alloc] initWithPDBData:ADPb_0_PDB];
    
    pdbData *PO4b_0_PDB = [[pdbData alloc] init];
    PO4b_0_PDB.CPK = YES;
    [PO4b_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_PO4b.pdb"];
    modelObject *PO4b_0 = [[modelObject alloc] initWithPDBData:PO4b_0_PDB];

    pdbData *ATP_0_PDB = [[pdbData alloc] init];
    ATP_0_PDB.CPK = YES;
    [ATP_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_ATP.pdb"];
    modelObject *ATP_0 = [[modelObject alloc] initWithPDBData:ATP_0_PDB];

    pdbData *ATPh_0_PDB = [[pdbData alloc] init];
    ATPh_0_PDB.CPK = YES;
    [ATPh_0_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/0_ATPh.pdb"];
    modelObject *ATPh_0 = [[modelObject alloc] initWithPDBData:ATPh_0_PDB];

    pdbData *ADPh_1_PDB = [[pdbData alloc] init];
    ADPh_1_PDB.CPK = YES;
    [ADPh_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_ADPh.pdb"];
    modelObject *ADPh_1 = [[modelObject alloc] initWithPDBData:ADPh_1_PDB];
    
    pdbData *PO4h_1_PDB = [[pdbData alloc] init];
    PO4h_1_PDB.CPK = YES;
    [PO4h_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_PO4h.pdb"];
    modelObject *PO4h_1 = [[modelObject alloc] initWithPDBData:PO4h_1_PDB];

    pdbData *ADPe_1_PDB = [[pdbData alloc] init];
    ADPe_1_PDB.CPK = YES;
    [ADPe_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_ADPe.pdb"];
    modelObject *ADPe_1 = [[modelObject alloc] initWithPDBData:ADPe_1_PDB];
    
    pdbData *PO4e_1_PDB = [[pdbData alloc] init];
    PO4e_1_PDB.CPK = YES;
    [PO4e_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_PO4e.pdb"];
    modelObject *PO4e_1 = [[modelObject alloc] initWithPDBData:PO4e_1_PDB];
    
    pdbData *ADPb_1_PDB = [[pdbData alloc] init];
    ADPb_1_PDB.CPK = YES;
    [ADPb_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_ADPb.pdb"];
    modelObject *ADPb_1 = [[modelObject alloc] initWithPDBData:ADPb_1_PDB];
    
    pdbData *PO4b_1_PDB = [[pdbData alloc] init];
    PO4b_1_PDB.CPK = YES;
    [PO4b_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_PO4b.pdb"];
    modelObject *PO4b_1 = [[modelObject alloc] initWithPDBData:PO4b_1_PDB];
    
    pdbData *ATP_1_PDB = [[pdbData alloc] init];
    ATP_1_PDB.CPK = YES;
    [ATP_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_ATP.pdb"];
    modelObject *ATP_1 = [[modelObject alloc] initWithPDBData:ATP_1_PDB];

    pdbData *ATPh_1_PDB = [[pdbData alloc] init];
    ATPh_1_PDB.CPK = YES;
    [ATPh_1_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/1_ATPh.pdb"];
    modelObject *ATPh_1 = [[modelObject alloc] initWithPDBData:ATPh_1_PDB];

    pdbData *ADPh_2_PDB = [[pdbData alloc] init];
    ADPh_2_PDB.CPK = YES;
    [ADPh_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_ADPh.pdb"];
    modelObject *ADPh_2 = [[modelObject alloc] initWithPDBData:ADPh_2_PDB];
    
    pdbData *PO4h_2_PDB = [[pdbData alloc] init];
    PO4h_2_PDB.CPK = YES;
    [PO4h_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_PO4h.pdb"];
    modelObject *PO4h_2 = [[modelObject alloc] initWithPDBData:PO4h_2_PDB];

    pdbData *ADPe_2_PDB = [[pdbData alloc] init];
    ADPe_2_PDB.CPK = YES;
    [ADPe_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_ADPe.pdb"];
    modelObject *ADPe_2 = [[modelObject alloc] initWithPDBData:ADPe_2_PDB];
    
    pdbData *PO4e_2_PDB = [[pdbData alloc] init];
    PO4e_2_PDB.CPK = YES;
    [PO4e_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_PO4e.pdb"];
    modelObject *PO4e_2 = [[modelObject alloc] initWithPDBData:PO4e_2_PDB];
    
    pdbData *ADPb_2_PDB = [[pdbData alloc] init];
    ADPb_2_PDB.CPK = YES;
    [ADPb_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_ADPb.pdb"];
    modelObject *ADPb_2 = [[modelObject alloc] initWithPDBData:ADPb_2_PDB];
    
    pdbData *PO4b_2_PDB = [[pdbData alloc] init];
    PO4b_2_PDB.CPK = YES;
    [PO4b_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_PO4b.pdb"];
    modelObject *PO4b_2 = [[modelObject alloc] initWithPDBData:PO4b_2_PDB];
    
    pdbData *ATP_2_PDB = [[pdbData alloc] init];
    ATP_2_PDB.CPK = YES;
    [ATP_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_ATP.pdb"];
    modelObject *ATP_2 = [[modelObject alloc] initWithPDBData:ATP_2_PDB];

    pdbData *ATPh_2_PDB = [[pdbData alloc] init];
    ATPh_2_PDB.CPK = YES;
    [ATPh_2_PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/FType/2_ATPh.pdb"];
    modelObject *ATPh_2 = [[modelObject alloc] initWithPDBData:ATPh_2_PDB];

    
//    modelObject *atpaseArray = [[modelObject alloc] init];
//    [atpaseArray addGridOfModel:atpaseLeft xNumMembers:1 xSpacing:0 zNumMembers:10 zSpacing:100];
//    [atpaseArray addGridOfModel:atpaseRight xNumMembers:1 xSpacing:0 zNumMembers:10 zSpacing:100];
    NSMutableArray *sceneATPases = [[NSMutableArray alloc] init];
    [sceneATPases addObject:atpaseLeft];

    modelObject *newWorld = [[modelObject alloc] init];
    [newWorld addChildModel:atpaseLeft];
//    [newWorld addChildModel:supercomplex];
    [newWorld setName:@"atpaseLeft" forChild:atpaseLeft];
    [newWorld setName:@"atpase" forChild:atpase];
    [newWorld setName:@"atpaseRotate" forChild:atpaseRotate];
    [newWorld setName:@"rotor" forChild:rotor];
    [newWorld setName:@"subC" forChild:atpase];
    [newWorld setName:@"sceneATPases" forChild:(modelObject *)sceneATPases];
    [newWorld setName:@"innerStartCurve" forChild:(modelObject *)innerStartCurve];
    [newWorld setName:@"innerEndCurve" forChild:(modelObject *)innerEndCurve];
    [newWorld setName:@"outerStartCurve" forChild:(modelObject *)outerStartCurve];
    [newWorld setName:@"outerEndCurve" forChild:(modelObject *)outerEndCurve];
    [newWorld setName:@"innerStartCurveForMembrane" forChild:(modelObject *)innerStartCurveForMembrane];
    [newWorld setName:@"innerEndCurveForMembrane" forChild:(modelObject *)innerEndCurveForMembrane];
    [newWorld setName:@"innerInsideCurveForMembrane" forChild:(modelObject *)innerInsideCurve];
    [newWorld setName:@"innerEndInsideCurveForMembrane" forChild:(modelObject *)innerEndInsideCurve];
    [newWorld setName:@"innerStartBoundaryCurve" forChild:(modelObject *)innerBoundaryCurve];
    [newWorld setName:@"innerEndBoundaryCurve" forChild:(modelObject *)innerEndBoundaryCurve];
    [newWorld setName:@"IMPopCCurve" forChild:IMpopCCurve];
    [newWorld setName:@"IMPopCCurveInner" forChild:IMpopCCurveInner];
//    [newWorld addChildModel:atpaseRight];
//    [newWorld setName:@"atpaseRight" forChild:atpaseRight];
//    [newWorld addChildModel:popCCurve];
//    [newWorld addChildModel:popCCurveLeft];
//    [newWorld addChildModel:popCCurveLower];
//    [newWorld addChildModel:membrane];
    [newWorld setName:@"membrane" forChild:membrane];
    [newWorld setName:@"popCCurve" forChild:IMpopCCurve];
    [newWorld setName:@"popCCurveHeadOnly" forChild:IMpopCCurveHeadOnly];
//    [newWorld setName:@"popCCurveLower" forChild:popCCurveLower];
    [newWorld setName:@"popC" forChild:popc];
//    [newWorld addChildModel:protonPool];
    [newWorld setName:@"protonPool" forChild:protonPool];
//    [newWorld addChildModel:matrixPool];
    [newWorld setName:@"matrixPool" forChild:matrixPool];
//    [newWorld addChildModel:matrixADPPool];
    [newWorld setName:@"matrixADPPool" forChild:matrixADPPool];
//    [newWorld addChildModel:matrixPO4Pool];
    [newWorld setName:@"matrixPO4Pool" forChild:matrixPO4Pool];
//    [newWorld addChildModel:matrixATPPool];
    [newWorld setName:@"matrixATPPool" forChild:matrixATPPool];
    [newWorld setName:@"ATP" forChild:atp];
    [newWorld setName:@"po4ForATP" forChild:po4CNoO];
    [newWorld setName:@"ATPGlow" forChild:atpGlow];
    [newWorld setName:@"ADP" forChild:adp];
    [newWorld setName:@"PO4" forChild:po4];
    [newWorld setName:@"proton" forChild:proton];
//    [newWorld addChildModel:atpaseArray];
//    [newWorld setName:@"atpase" forChild:atpase];
    [newWorld setName:@"2_ADPh" forChild:ADPh_0];
    [newWorld setName:@"2_PO4h" forChild:PO4h_0];
    [newWorld setName:@"2_ADPe" forChild:ADPe_0];
    [newWorld setName:@"2_PO4e" forChild:PO4e_0];
    [newWorld setName:@"1_ADPb" forChild:ADPb_0];
    [newWorld setName:@"1_PO4b" forChild:PO4b_0];
    [newWorld setName:@"0_ATP" forChild:ATP_0];
    [newWorld setName:@"0_ATPh" forChild:ATPh_0];
    [newWorld setName:@"0_ADPh" forChild:ADPh_1];
    [newWorld setName:@"0_PO4h" forChild:PO4h_1];
    [newWorld setName:@"1_ADPe" forChild:ADPe_1];
    [newWorld setName:@"1_PO4e" forChild:PO4e_1];
    [newWorld setName:@"0_ADPb" forChild:ADPb_1];
    [newWorld setName:@"0_PO4b" forChild:PO4b_1];
    [newWorld setName:@"2_ATP" forChild:ATP_1];
    [newWorld setName:@"1_ATPh" forChild:ATPh_1];
    [newWorld setName:@"1_ADPh" forChild:ADPh_2];
    [newWorld setName:@"1_PO4h" forChild:PO4h_2];
    [newWorld setName:@"0_ADPe" forChild:ADPe_2];
    [newWorld setName:@"0_PO4e" forChild:PO4e_2];
    [newWorld setName:@"2_ADPb" forChild:ADPb_2];
    [newWorld setName:@"2_PO4b" forChild:PO4b_2];
    [newWorld setName:@"1_ATP" forChild:ATP_2];
    [newWorld setName:@"2_ATPh" forChild:ATPh_2];
    
//    NSLog(@"Finished");
    
    return newWorld;
    
}

- (modelObject *)loadSceneFinalATP {
    NSLog(@"Loading data");
    
    RGBColour specColour;
    specColour.red = 0.6;
    specColour.green = 0.6;
    specColour.blue = 0.6;
    
    RGBColour ATPColour;
    ATPColour.red = 0.8;
    ATPColour.green = 0.0;
    ATPColour.blue = 0.0;
    
    RGBColour glowColour;
    glowColour.red = 1.0;
    glowColour.green = 1.0;
    glowColour.blue = 0.5;

    //Adenosine
    pdbData *adenosinePDB = [[pdbData alloc] init];
    [adenosinePDB setDiffuseColour:ATPColour specularColour:specColour shininess:100.0 mirrorFrac:0.5];
    adenosinePDB.CPK = YES;
    [adenosinePDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Adenosine.pdb"];
    modelObject *adenosine = [[modelObject alloc] initWithPDBData:adenosinePDB];
    
    //P alpha
    pdbData *paPDB = [[pdbData alloc] init];
    [paPDB setDiffuseColour:ATPColour specularColour:specColour shininess:100.0 mirrorFrac:0.5];
    paPDB.CPK = YES;
    [paPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4_alpha.pdb"];
    modelObject *pa = [[modelObject alloc] initWithPDBData:paPDB];

    //P beta
    pdbData *pbPDB = [[pdbData alloc] init];
    [pbPDB setDiffuseColour:ATPColour specularColour:specColour shininess:100.0 mirrorFrac:0.5];
    pbPDB.CPK = YES;
    [pbPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4_beta_NoO.pdb"];
    modelObject *pbNoO = [[modelObject alloc] initWithPDBData:pbPDB];

    //P beta O
    pdbData *pboPDB = [[pdbData alloc] init];
    [pboPDB setDiffuseColour:ATPColour specularColour:specColour shininess:100.0 mirrorFrac:0.5];
    pboPDB.CPK = YES;
    [pboPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/ADP_O.pdb"];
    modelObject *pbo = [[modelObject alloc] initWithPDBData:pboPDB];

    modelObject *pb = [[modelObject alloc] init];
    [pb addChildModel:pbNoO];
    [pb addChildModel:pbo];
    
    //P gamma
    pdbData *pgPDB = [[pdbData alloc] init];
    [pgPDB setDiffuseColour:ATPColour specularColour:specColour shininess:100.0 mirrorFrac:0.5];
    pgPDB.CPK = YES;
    [pgPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4_gamma.pdb"];
    modelObject *pgForRotation = [[modelObject alloc] initWithPDBData:pgPDB];
    [pgForRotation centerModelOnOrigin];
    
    modelObject *pg = [[modelObject alloc] init];
    [pg addChildModel:pgForRotation];
    [pg translateToX:7.161 Y:-4.998 Z:-2.116];
    
    modelObject *atp = [[modelObject alloc] init];
    [atp addChildModel:adenosine];
    [atp addChildModel:pa];
    [atp addChildModel:pb];
    [atp addChildModel:pg];
    [atp centerModelOnOrigin];
    [atp rotateAroundX:-70 * radiansPerDegree Y:170 * radiansPerDegree Z:180 * radiansPerDegree];
    
    modelObject *newWorld = [[modelObject alloc] init];
    [newWorld addChildModel:atp];
    [newWorld setName:@"atp" forChild:atp];
    [newWorld setName:@"adenosine" forChild:adenosine];
    [newWorld setName:@"pa" forChild:pa];
    [newWorld setName:@"pb" forChild:pb];
    [newWorld setName:@"pg" forChild:pg];
    [newWorld setName:@"pbo" forChild:pbo];
    [newWorld setName:@"pgForRotation" forChild:pgForRotation];
    
    NSLog(@"Finished");
    
    return newWorld;
    
}


- (modelObject *)loadSceneTest {
    NSLog(@"Loading data");
    
    pdbData *adpPDB = [[pdbData alloc] init];
    [adpPDB setDiffuseR:1.5 diffuseG:0 diffuseB:0 specR:0.6 specG:0.6 specB:0.6 shininess:50 mirrorFrac:0.0];
    adpPDB.CPK = NO;
    [adpPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/ADP.pdb"];

    pdbData *adpoPDB = [[pdbData alloc] init];
    adpoPDB.CPK = NO;
    [adpoPDB setDiffuseR:0.8 diffuseG:0 diffuseB:0 specR:0.6 specG:0.6 specB:0.6 shininess:50 mirrorFrac:0.0];
    [adpoPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/ADP_O.pdb"];

    pdbData *po4PDB = [[pdbData alloc] init];
    po4PDB.CPK = NO;
    [po4PDB setDiffuseR:0.8 diffuseG:0 diffuseB:0 specR:0.6 specG:0.6 specB:0.6 shininess:50 mirrorFrac:0.0];
    [po4PDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4.pdb"];

    pdbData *po4OPDB = [[pdbData alloc] init];
    po4OPDB.CPK = NO;
    [po4OPDB setDiffuseR:0.8 diffuseG:0 diffuseB:0 specR:0.6 specG:0.6 specB:0.6 shininess:50 mirrorFrac:0.0];
    [po4OPDB initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/PO4_O.pdb"];

    RGBColour iC;
    iC.red = 1.2;
    iC.green = 1.2;
    iC.blue = 1.2;
    modelObject *adpo = [[modelObject alloc] initWithPDBData:adpoPDB];
//    [adpo animateIntrinsicColourTo:iC withMaxDistance:10 mode:REAL_POINT_SOURCE duration:20];
//    [adpo changeIntrinsicColourTo:iC withMaxDistance:10.0 mode:REAL_POINT_SOURCE];
//    [adpo centerModelOnOrigin];
//    [adpo translateToX:6 Y:5.5 Z:-8];
//    [adpo logIntrinsicLightData];
    
    modelObject *adp = [[modelObject alloc] initWithPDBData:adpPDB];
//    [adp addChildModel:adpo];
    
    modelObject *po4o = [[modelObject alloc] initWithPDBData:po4OPDB];
//    [po4o animateIntrinsicColourTo:iC withMaxDistance:10 mode:REAL_POINT_SOURCE duration:20];
//    [po4o changeIntrinsicColourTo:iC withMaxDistance:10.0 mode:REAL_POINT_SOURCE];
    
    modelObject *po4 = [[modelObject alloc] initWithPDBData:po4PDB];
    [po4 addChildModel:po4o];
    
    modelObject *po4a = [[modelObject alloc] init];
    [po4a addChildModel:po4];
    [po4a centerModelOnOrigin];
//    [po4a rotateAroundX:30 * radiansPerDegree Y:0 Z:0];
//    [po4a translateToX:-5 Y:0 Z:0];

    modelObject *po4b = [[modelObject alloc] init];
    [po4b addChildModel:po4];
    [po4b centerModelOnOrigin];
    [po4b rotateAroundX:30 * radiansPerDegree Y:0 Z:0];
    [po4b translateToX:5 Y:0 Z:0];
    [po4b setClipForModelTo:YES];
    RGBColour bC;
    bC.red = 0;
    bC.green = 0.6;
    bC.blue = 0;
    [po4b changeDiffuseColourTo:bC];

    Vector axis;
    float angle;
    Vector trans;
    [po4a targetMolecule:po4b requiredRotationAxis:&axis requiredRotationAngle:&angle requiredTranslationVector:&trans];
//    [po4a rotateAroundVector:axis byAngle:angle];
    [po4a animateRotationAroundAxis:axis byAngle:angle duration:20];
    
    modelObject *po4c = [[modelObject alloc] init];
    [po4c addChildModel:po4a];
    [po4c translateToX:-5 Y:0 Z:0];
    
    modelObject *atp = [[modelObject alloc] init];
    [atp addChildModel:adp];
    [atp addChildModel:po4];
    [atp centerModelOnOrigin];
//    [atp rotateAroundX:-70 * radiansPerDegree Y:180 * radiansPerDegree Z:180 * radiansPerDegree];
    
    Vector c1, c2, e1;
    c1.x = -400; c1.y = 30; c1.z = -100; c1.w = 0;
    c2.x = 400; c2.y = 150; c2.z = 100; c2.w = 0;
    e1.x = 0; e1.y = 150; e1.z = -100; e1.w = 0;
    modelObject *atpPool = [[modelObject alloc] init];
    [atpPool setupPoolOfModel:atp numModels:1 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [atpPool enablePoolDiffusionWithMaxTransSpeed:1.5 maxRotSpeed:0.1 transChangeSize:0.1 rotChangeSize:0.01];

    c1.x = -400; c1.y = -150; c1.z = -100; c1.w = 0;
    c2.x = 400; c2.y = 150; c2.z = 100; c2.w = 0;
    modelObject *atpPool2 = [[modelObject alloc] init];
    [atpPool2 setupPoolOfModel:atpPool numModels:1 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];

    modelObject *newWorld = [[modelObject alloc] init];
//    [newWorld addChildModel:atpPool];
//    [newWorld addChildModel:atpPool2];
//    [newWorld addChildModel:atp];
//    [newWorld setName:@"atp" forChild:atp];
//    [newWorld addChildModel:adpo];
    [newWorld addChildModel:po4c];
    [newWorld addChildModel:po4b];
        
    NSLog(@"Finished");
    
    return newWorld;

}

- (modelObject *)loadSceneOld {
    
    NSLog(@"Loading data");
    /*pdbData *data = [[pdbData alloc] init];
    data.diffuse_R = 0.6;
    data.diffuse_G = 0.6;
    data.diffuse_B = 0.6;
    data.specular_R = 0.7;
    data.specular_G = 0.7;
    data.specular_B = 0.7;
    data.shininess = 100;
    data.mirrorFraction = 0.0;
    data.CPK = NO;
//    [data initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/2WC9.pdb"];
    [data initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/AD_morph.pdb"];
    
    pdbData *beData = [[pdbData alloc] init];
    beData.diffuse_R = 0.4;
    beData.diffuse_G = 0.4;
    beData.diffuse_B = 0.4;
    beData.specular_R = 0.7;
    beData.specular_G = 0.7;
    beData.specular_B = 0.7;
    beData.shininess = 100;
    beData.mirrorFraction = 0.0;
    beData.CPK = NO;
    [beData initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/BE_morph.pdb"];

    pdbData *CFData = [[pdbData alloc] init];
    CFData.diffuse_R = 0.8;
    CFData.diffuse_G = 0.8;
    CFData.diffuse_B = 0.8;
    CFData.specular_R = 0.7;
    CFData.specular_G = 0.7;
    CFData.specular_B = 0.7;
    CFData.shininess = 5;
    CFData.mirrorFraction = 0.0;
    CFData.CPK = NO;
    [CFData initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/CF_morph.pdb"];
    
    pdbData *DFCLdata = [[pdbData alloc] init];
    DFCLdata.diffuse_R = 0.4;
    DFCLdata.diffuse_G = 0.1;
    DFCLdata.diffuse_B = 0.1;
    DFCLdata.specular_R = 0.8;
    DFCLdata.specular_G = 0.4;
    DFCLdata.specular_B = 0.1;
    DFCLdata.shininess = 5;
    DFCLdata.mirrorFraction = 0.0;
    DFCLdata.CPK = NO;
    [DFCLdata initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/DFCL_morph.pdb"];

    pdbData *distdata = [[pdbData alloc] init];
    distdata.diffuse_R = 0.1;
    distdata.diffuse_G = 0.2;
    distdata.diffuse_B = 0.7;
    distdata.specular_R = 0.1;
    distdata.specular_G = 0.4;
    distdata.specular_B = 0.8;
    distdata.shininess = 5;
    distdata.mirrorFraction = 0.0;
    distdata.CPK = NO;
    [distdata initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/dist_morph.pdb"];

    pdbData *iSolData = [[pdbData alloc] init];
    iSolData.diffuse_R = 0.1;
    iSolData.diffuse_G = 0.2;
    iSolData.diffuse_B = 0.7;
    iSolData.specular_R = 0.1;
    iSolData.specular_G = 0.4;
    iSolData.specular_B = 0.8;
    iSolData.shininess = 5;
    iSolData.mirrorFraction = 0.0;
    iSolData.CPK = NO;
    [iSolData initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/iSol_morph.pdb"];

    pdbData *proxData = [[pdbData alloc] init];
    proxData.diffuse_R = 0.1;
    proxData.diffuse_G = 0.2;
    proxData.diffuse_B = 0.7;
    proxData.specular_R = 0.1;
    proxData.specular_G = 0.4;
    proxData.specular_B = 0.8;
    proxData.shininess = 5;
    proxData.mirrorFraction = 0.0;
    proxData.CPK = NO;
    [proxData initWithMultiStatePDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/prox_morph.pdb"];

    pdbData *iMemData = [[pdbData alloc] init];
    iMemData.diffuse_R = 0.1;
    iMemData.diffuse_G = 0.2;
    iMemData.diffuse_B = 0.7;
    iMemData.specular_R = 0.1;
    iMemData.specular_G = 0.4;
    iMemData.specular_B = 0.8;
    iMemData.shininess = 5;
    iMemData.mirrorFraction = 0.0;
    iMemData.CPK = NO;
    [iMemData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/Imem.pdb"];

    modelObject *ad = [[modelObject alloc] initWithPDBData:data];
    [ad animateModelStateWithInitialOffset:0];
    
    modelObject *be = [[modelObject alloc] initWithPDBData:beData];
    [be animateModelStateWithInitialOffset:0];
    
    modelObject *cf = [[modelObject alloc] initWithPDBData:CFData];
    [cf animateModelStateWithInitialOffset:0];
    
    //    RGBColour redLight;
    //    redLight.red = 0.4; redLight.green = 0.1; redLight.blue = 0.1;
    modelObject *dfcl = [[modelObject alloc] initWithPDBData:DFCLdata];
    //    [dfcl changeIntrinsicColourTo:redLight withMaxDistance:30.0];
    [dfcl animateModelStateWithInitialOffset:0];
    
    modelObject *dist = [[modelObject alloc] initWithPDBData:distdata];
    [dist animateModelStateWithInitialOffset:0];
    
    modelObject *iSol = [[modelObject alloc] initWithPDBData:iSolData];
    [iSol animateModelStateWithInitialOffset:0];
    
    modelObject *prox = [[modelObject alloc] initWithPDBData:proxData];
    [prox animateModelStateWithInitialOffset:0];
    
    modelObject *iMem = [[modelObject alloc] initWithPDBData:iMemData];
    [iMem enableWobbleWithMaxRadius:0.5 changeVectorSize:0.1];*/
    
    pdbData *popcData = [[pdbData alloc] init];
    popcData.diffuse_R = 0.7;
    popcData.diffuse_G = 0.7;
    popcData.diffuse_B = 0.1;
    popcData.specular_R = 0.7;
    popcData.specular_G = 0.7;
    popcData.specular_B = 0.1;
    popcData.shininess = 5;
    popcData.mirrorFraction = 0.0;
    popcData.CPK = NO;
    [popcData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/popc.pdb"];
    
    pdbData *protonData = [[pdbData alloc] init];
    protonData.diffuse_R = 0.0;
    protonData.diffuse_G = 0.0;
    protonData.diffuse_B = 0.0;
    protonData.specular_R = 0.0;
    protonData.specular_G = 0.0;
    protonData.specular_B = 0.0;
//    protonData.intrinsic_R = 0.8;
//    protonData.intrinsic_G = 0.8;
//    protonData.intrinsic_B = 0.8;
    protonData.mirrorFraction = 0.0;
    protonData.shininess = 5;
    protonData.CPK = NO;
    [protonData initWithPDBFile:@"/Users/stocklab/Documents/Callum/rt1NG/rt1/structureData/proton.pdb"];
    

    modelObject *popc = [[modelObject alloc] initWithPDBData:popcData];
    
    RGBColour light;
    light.red = light.green = light.blue = 1.2;
    modelObject *proton = [[modelObject alloc] initWithPDBData:protonData];
//    [proton changeIntrinsicColourTo:light withMaxDistance:6.0];
    [proton centerModelOnOrigin];

    Vector c1, c2, e1;
    c1.x = -200; c1.y = 220; c1.z = 0; c1.w = 0;
    c2.x = 200; c2.y = 320; c2.z = 100; c2.w = 0;
    e1.x = 200; e1.y = 320; e1.z = 0; e1.w = 0;
//    [proton enableDiffusionWithMaxTransSpeed:1.0 maxRotSpeed:0.1 transChangeSize:0.05 rotChangeSize:0.01 minCorner:c1 maxCorner:c2];
    
    modelObject *protonPool = [[modelObject alloc] init];
    [protonPool setupPoolOfModel:proton numModels:50 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    [protonPool enablePoolDiffusionWithMaxTransSpeed:1.0 maxRotSpeed:0.1 transChangeSize:0.05 rotChangeSize:0.01];
    [protonPool enableWobbleWithMaxRadius:2.0 changeVectorSize:0.5];
//    c2.y = 0;
//    [protonPool changePoolBoundsToCorner1:c1 boundingCorner2:c2];
    
    modelObject *cPool = [[modelObject alloc] init];
    c1.x = -30; c1.y = 220; c1.z = 0; c1.w = 0;
    c2.x = 30; c2.y = 50; c2.z = 100; c2.w = 0;
    e1.x = 200; e1.y = 320; e1.z = 0; e1.w = 0;
    [cPool setupPoolOfModel:proton numModels:0 boundingCorner1:c1 boundingCorner2:c2 newModelEntryPoint:e1];
    
    /*modelObject *protonRing = [[modelObject alloc] init];
    [protonRing addCircleOfModel:proton withAngleOffset:5 * radiansPerDegree numMembers:12 radius:29];
    [protonRing centerModelOnOrigin];
    [protonRing animateRotationAroundX:0 Y:-120 * radiansPerDegree Z:0 duration:40];

    modelObject *tranlatedProtonRing = [[modelObject alloc] init];
    [tranlatedProtonRing addChildModel:protonRing];
    [tranlatedProtonRing rotateAroundX:0 Y:0 Z:-10 * radiansPerDegree];
    [tranlatedProtonRing translateToX:-3 Y:120 Z:-7];*/
    
    
    modelObject *popcRotate = [[modelObject alloc] init];
    [popcRotate addChildModel:popc];
    [popcRotate rotateAroundX:0 Y:0 Z:180 * radiansPerDegree];
    
    modelObject *popCCurve = [[modelObject alloc] init];
    Vector start, end, i1, i2;
    start.x = -100; start.y = 300; start.z = 0; start.w = 0;
    end.x = 100; end.y = 300; end.z = 0; end.w = 0;
    i1.x = -160; i1.y = -100; i1.z = 0; i1.w = 0;
    i2.x = 160; i2.y = -100; i2.z = 0; i2.w = 0;
    Vector modelOrientation;
    modelOrientation.x = 0;
    modelOrientation.y = -1.0;
    modelOrientation.z = 0;
    modelOrientation.w = 0.0;
//    [popCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 start:start end:end i1:i1 i2:i2];
//    [popCCurve addParametricLineOfModel:popc spacing:6.0 start:start end:end i1:i1 i2:i2 rStart:-90 * radiansPerDegree rEnd:90 * radiansPerDegree rI1:0 rI2:0];
//    [popCCurve translateToX:0 Y:-30 Z:50];
//    [popCCurve enableWobbleWithMaxRadius:1.5 changeVectorSize:0.3];
    start.x = -200; start.y = 200; start.z = 0; start.w = 0;
    end.x = -75; end.y = 200; end.z = 0; end.w = 0;
    i1.x = -166; i1.y = 200; i1.z = 0; i1.w = 0;
    i2.x = -125; i2.y = 200; i2.z = 0; i2.w = 0;
    beizerCurve *testCurve = [[beizerCurve alloc] init];
    [testCurve addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    end.x = 0; end.y = 0; end.z = 0; end.w = 0;
    i2.x = -55; i2.y = 0; i2.z = 0; i2.w = 0;
    [testCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 75; end.y = 200; end.z = 0; end.w = 0;
    i2.x = 25; i2.y = 200; i2.z = 0; i2.w = 0;
    [testCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 200; end.y = 200; end.z = 0; end.w = 0;
    i2.x = 166; i2.y = 200; i2.z = 0; i2.w = 0;
    [testCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    
    beizerCurve *flatCurve = [[beizerCurve alloc] init];
    start.x = -200; start.y = 200; start.z = 0; start.w = 0;
    end.x = -75; end.y = 200; end.z = 0; end.w = 0;
    i1.x = -166; i1.y = 200; i1.z = 0; i1.w = 0;
    i2.x = -125; i2.y = 200; i2.z = 0; i2.w = 0;
    [flatCurve addCurveWithStartPoint:start i1:i1 i2:i2 end:end];
    end.x = 0; end.y = 200; end.z = 0; end.w = 0;
    i2.x = -55; i2.y = 200; i2.z = 0; i2.w = 0;
    [flatCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 75; end.y = 200; end.z = 0; end.w = 0;
    i2.x = 25; i2.y = 200; i2.z = 0; i2.w = 0;
    [flatCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
    end.x = 200; end.y = 200; end.z = 0; end.w = 0;
    i2.x = 166; i2.y = 200; i2.z = 0; i2.w = 0;
    [flatCurve addCurveWithSymmetricalJoinWithI2:i2 end:end];
        
    [popCCurve addParametricLineOfModel:popc modelOrientation:modelOrientation spacing:6.0 offset:0 bezierCurve:flatCurve];
    [popCCurve animateMaintainModelsOnCurveFrom:flatCurve to:testCurve originalModel:popc modelOrientation:modelOrientation spacing:6.0 duration:10];
//    [popCCurve centerModelOnOrigin];
    [popCCurve enableWobbleWithMaxRadius:1.5 changeVectorSize:0.3];
    

    modelObject *popCCurveLower = [[modelObject alloc] init];
    start.x = -110; start.y = 160; start.z = 0; start.w = 0;
    end.x = 110; end.y = 160; end.z = 0; end.w = 0;
    i1.x = -0; i1.y = -10; i1.z = 0; i1.w = 0;
    i2.x = 0; i2.y = -10; i2.z = 0; i2.w = 0;
//    [popCCurveLower addParametricLineOfModel:popcRotate spacing:6.0 start:start end:end i1:i1 i2:i2 rStart:-60 * radiansPerDegree rEnd:60 * radiansPerDegree rI1:0 rI2:0];
    [popCCurveLower translateToX:0 Y:20 Z:50];
    [popCCurveLower enableWobbleWithMaxRadius:1.5 changeVectorSize:0.3];

//    modelObject *extraMemb = [[modelObject alloc] init];
//    [extraMemb addChildModel:popCCurve];
//    [extraMemb translateToX:0 Y:-250 Z:0];
    
    modelObject *membrane = [[modelObject alloc] init];
    [membrane addGridOfModel:popCCurve xNumMembers:1 xSpacing:0 zNumMembers:5 zSpacing:6.0];
//    [membrane addGridOfModel:popCCurveLower xNumMembers:1 xSpacing:0 zNumMembers:1 zSpacing:6.0];
    
    /*modelObject *ATPase = [[modelObject alloc] init];
    [ATPase addChildModel:ad];
    [ATPase addChildModel:be];
    [ATPase addChildModel:cf];
    [ATPase addChildModel:dfcl];
    [ATPase addChildModel:dist];
    [ATPase addChildModel:iSol];
    [ATPase addChildModel:iMem];
    [ATPase addChildModel:prox];
    [ATPase centerModelOnOrigin];
    [ATPase rotateAroundX:90 * radiansPerDegree Y:0 Z:0];
    [ATPase centerModelOnOrigin];
    [ATPase rotateAroundX:0 Y:80 * radiansPerDegree Z:0];
    [ATPase centerModelOnOrigin];
    [ATPase enableWobbleWithMaxRadius:0.7 changeVectorSize:0.1];

    c1.x = -500; c1.y = -500; c1.z = -400; c1.w = 0;
    c2.x = 500; c2.y = 500; c2.z = 400; c2.w = 0;

//    [ATPase enableDiffusionWithMaxTransSpeed:1.0 maxRotSpeed:0.02 transChangeSize:0.05 rotChangeSize:0.002 minCorner:c1 maxCorner:c2];
    
    
    modelObject *ATPaseLeft = [[modelObject alloc] init];
    Vector attachPoint;
    attachPoint.x = 0;
    attachPoint.y = 80;
    attachPoint.z = 0;
    attachPoint.w = 1.0;
    [ATPaseLeft addChildModel:ATPase onToCurve:flatCurve curveFraction:0.30 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
    [ATPaseLeft animateMaintainModelsOnCurveFrom:flatCurve to:testCurve originalModel:ATPase modelOrientation:modelOrientation spacing:0.0 duration:50];
    [ATPaseLeft animateCurvePositionTo:0.4 duration:50];
    
//    [ATPaseLeft addChildModel:ATPase];
//    [ATPaseLeft addChildModel:tranlatedProtonRing];
//    [ATPaseLeft rotateAroundX:0 Y:180 * radiansPerDegree Z:0];
//    [ATPaseLeft rotateAroundX:0 Y:0 Z:-55 * radiansPerDegree];
//    [ATPaseLeft translateToX:-140 Y:0 Z:0];

    
    
    modelObject *ATPaseRight = [[modelObject alloc] init];
    [ATPaseRight addChildModel:ATPase onToCurve:flatCurve curveFraction:0.80 modelOrientation:modelOrientation modelAttachmentPoint:attachPoint];
    [ATPaseRight animateMaintainModelsOnCurveFrom:flatCurve to:testCurve originalModel:ATPase modelOrientation:modelOrientation spacing:0.0 duration:50];
    [ATPaseRight animateCurvePositionTo:0.6 duration:50];

//    [ATPaseRight addChildModel:ATPase];
//    [ATPaseRight addChildModel:tranlatedProtonRing];
//    [ATPaseRight rotateAroundX:0 Y:0 Z:55 * radiansPerDegree];
//    [ATPaseRight translateToX:140 Y:0 Z:0];

    modelObject *ATPaseArray = [[modelObject alloc] init];
    [ATPaseArray addGridOfModel:ATPaseLeft xNumMembers:1 xSpacing:0 zNumMembers:10 zSpacing:200];
    [ATPaseArray addGridOfModel:ATPaseRight xNumMembers:1 xSpacing:0 zNumMembers:10 zSpacing:200];*/
    
    
    modelObject *newWorld = [[modelObject alloc] init];
//    [newWorld addChildModel:ATPaseArray];
//    [newWorld addChildModel:ATPaseLeft];
    [newWorld addChildModel:protonPool];
    [newWorld setName:@"protonPool" forChild:protonPool];
    [newWorld addChildModel:cPool];
    [newWorld setName:@"cpool" forChild:cPool];
//    [newWorld addChildModel:ATPaseRight];
//    [newWorld addChildModel:ATPase];
//    [newWorld addChildModel:tranlatedProtonRing];
    [newWorld addChildModel:membrane];
//    [newWorld addChildModel:extraMemb];
    //    [newWorld addChildModel:test2];
    //    [newWorld addChildModel:popcMonomer];
    //        [newWorld logModelData];
    
//    [newWorld logIntrinsicLightData];
    NSLog(@"Finished");
    
    return newWorld;
}

@end
